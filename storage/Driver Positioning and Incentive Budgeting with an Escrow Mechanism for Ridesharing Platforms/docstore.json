{"docstore/metadata": {"27bfdc15-3f59-4992-8659-4b532ba28f77": {"doc_hash": "0867c77b35eeb1450cb63a129da73e5e971535d9a32cf3922811b9e1c130905b"}, "3888170d-5508-4326-85f4-e9f7a8471b80": {"doc_hash": "bc5f7514f2b00f508731dec7d32efeeb0af0fee031e3b0196fcae238a676937e"}, "d40fbb26-d7a8-4d3e-a2d0-3e472a150254": {"doc_hash": "0f6868dcdca25630ae0aa6ce9340e0730e4a4e12ec47273cc4c8b04f2d88cdaa"}, "1117bc87-6ef8-452e-9754-9671a2ebb9ed": {"doc_hash": "2bc924de312e4431c0d51e17a97656a382e9f2cc7bf1b9e3c2b7ec95b295ffc5"}, "cb0da17b-71fb-4820-8b80-188bccf29b5e": {"doc_hash": "53b2b2a6bc67e013b6a0dd1b7b43699b39f8bb737d785f93115a34db580d781d"}, "0435041d-c9ef-4eb1-9b39-a907d02384fc": {"doc_hash": "2b9938b9900280880603f0a03c59d3b78ad5d7da3e60e932a41142448355d7ed"}, "e21f8e32-57bd-4673-bbf1-868381c1b8fe": {"doc_hash": "ba7103e4ea89e7935bf70fc6dc645ea175d4aa8aa55da2871f7f1e431a2285ea"}, "20899be0-7bb6-432e-aca4-523e402f5c06": {"doc_hash": "bff813d3ff236542431706732e5a6567d603b210e0b0006156f1f0a205d5c26a"}, "d257f9ff-57fa-4031-b2f2-0656b3345edd": {"doc_hash": "2244d8f11f76fe87664863a0a49d695b72c53e3dd513cc7ade779cc01ab13249"}, "93c933e3-1f25-45ef-9d39-ad622f69e126": {"doc_hash": "c1cb0a2998f39629240082e28a0f2dfe58c9a7b5ccf18e8e1956e094834c5a57"}, "0d3592d4-6aa8-4700-8c69-77087c11060c": {"doc_hash": "a1baa116df2c1a2e8d2afa44d98d19b9d9b505fd083eec1b78e775ceb3c1dd5c"}, "6882b8ec-6e55-45c7-b489-7ac2ba1f3488": {"doc_hash": "91c37095f8789fcbe637a916e774ba7004016c4d3a1cbadfa5104b72f10ccaa3"}, "bae8eb49-a2c5-46f1-b4ca-52407bc5c4a1": {"doc_hash": "336c0f82b5e9dab9b8b4bd6385f9778ff5ee13690ff9f2d680c83399a1b83581"}, "707987a8-0c39-47b7-94d1-9663fa24b198": {"doc_hash": "ff1f1c77793e5ac82a915f9aa2fd45b7bf4ac4661201102b943b866837389c5d"}, "3ef385b5-8499-4b8f-bf7c-44100a4762a6": {"doc_hash": "c25c8edbaaaf68044b891f828b4e416096ea5b17ed047129a0fcacd379051e44"}, "b75f3b15-933c-4b74-8b49-c7f9042e2149": {"doc_hash": "500892f44e905c113626d96caabfb15317bfe274102c290a6c4de6768bd8f9a8"}, "a81c6658-672d-41b7-8961-12fd3ce171d0": {"doc_hash": "008e36d9d29f826e701b4fc47b5107d83107bbab67761f687ea117d1aa53ecfa"}, "e8cf0a5a-bf22-4d0f-92f3-f3de3bdb9fc1": {"doc_hash": "ceef9ffaba1320ba0ea39b985df66ebdc0c9f673ac17ce3a5303690c6145fe1f"}, "e0e94bd9-aefb-47aa-8195-61507e4b77b2": {"doc_hash": "9d34861c4eb5ce80836251ace57c2acdf448742f7d5edba5fca5732cb9672902"}, "29defb66-e9ea-4784-be99-3eeba7203251": {"doc_hash": "3f7e90c98f442de69726611fe0dc7598d36ccf0eff35c90b4062243f0d1c7ca5"}, "96498834-119d-4552-a4ce-fcb1e47fb499": {"doc_hash": "369cfbe7a347f35eb4b4581c31e4903d6fccf9ca35e216108efd3d4b157daaa4"}, "97291e4a-0512-49d5-bdc6-ff4fb59f6ee4": {"doc_hash": "36c5aab85b7647309e9d9f8d5a67892475c6370b94ab98d69db89a496fd7e3ee"}, "eea54be3-50a9-4b54-a365-925aadb4a7e5": {"doc_hash": "a4f0a635e1b1b17fbb10bc4ae7ba18e10794eb10d45221ce23e37288fc98a924"}, "85fb42c9-7d17-4f14-bec1-af85400a4069": {"doc_hash": "fc1f746d0081fd18b00ef65e941e75e7373f3f3d8d0697af1978143c7236093f"}, "db618e43-6a7f-4e87-82a8-37232cd32937": {"doc_hash": "0ba35ac21622deb20aa5f08605be002263efcb1ba1840c18bee7fb0f5da9512a"}, "352aeac5-eaca-435e-9d74-354004736df1": {"doc_hash": "8eecd4e1791050bbc6ca43c2290d2e8d6c755cc1518848f57f09a91f22fe1f8e"}, "4a3a1a13-78a1-4a26-964f-294ff14386fc": {"doc_hash": "755f15c2b1cb118af8652c3091b44d3420a10f5470890018b3da6c9a94333f6b"}, "7bb116f6-1482-47cf-8c0b-5ff01e9de263": {"doc_hash": "56d382e2c45de695d2add60ad035339984f420aa95b7ce31a1d0f18ffd596ebe"}, "32d5fd23-84ed-4d13-9938-cf101daf425a": {"doc_hash": "37f5c0757cf5d92a42a16bf5e4fa2f73dbd44e84de767f5d1187d698fbbe0e5f"}, "369fd348-471b-4887-ad19-f02ddfeb684e": {"doc_hash": "5058351fbaf00008888cedd8cafb88828cff1095981ca6d7f681f28dad8a46dc"}, "0803b89a-0adf-4dab-9b17-68b99acfcf02": {"doc_hash": "8c539d4b071a43857cdba2034e6857e393f016a785071d1f70269fe71917de9a"}, "d2dd0f2c-3d39-414c-a7e0-a4cf7b3d0776": {"doc_hash": "29dfbb4b10b1098486716af3301433abaa4e4497a9cd433703505680adc1dc0e"}, "6224201b-4efd-42a0-9cef-0946e4fe84e2": {"doc_hash": "c4009c09aa3b9f6a9d0db40cd0da90a91f3a69b0401cca67af8915d4dfb85dc9"}, "44b5c628-e4cf-4b05-a77a-3b6353959098": {"doc_hash": "4c5cb864d6f613f120deec2700bd6ccc6c7341aefd42caf31d6e4c5161b8a880"}, "b1619346-c4a4-4190-bacb-f7a0411ad965": {"doc_hash": "febaf131872b92b5408d0a0f7d63821b65e48e564e3f1e0b37302973cc5a432f"}, "99fd3556-5fc5-43f3-85bf-302baa3df818": {"doc_hash": "0867c77b35eeb1450cb63a129da73e5e971535d9a32cf3922811b9e1c130905b", "ref_doc_id": "27bfdc15-3f59-4992-8659-4b532ba28f77"}, "f652ff15-f4f9-4144-b18f-b43dd2473816": {"doc_hash": "bc5f7514f2b00f508731dec7d32efeeb0af0fee031e3b0196fcae238a676937e", "ref_doc_id": "3888170d-5508-4326-85f4-e9f7a8471b80"}, "0ba16b7d-948e-4ba2-8b17-1f072eb1ab99": {"doc_hash": "0f6868dcdca25630ae0aa6ce9340e0730e4a4e12ec47273cc4c8b04f2d88cdaa", "ref_doc_id": "d40fbb26-d7a8-4d3e-a2d0-3e472a150254"}, "eb4dbd72-5035-42a4-8a77-a7216c260855": {"doc_hash": "2bc924de312e4431c0d51e17a97656a382e9f2cc7bf1b9e3c2b7ec95b295ffc5", "ref_doc_id": "1117bc87-6ef8-452e-9754-9671a2ebb9ed"}, "6a4ca8c1-d51a-4f6c-9cde-1361f7654247": {"doc_hash": "53b2b2a6bc67e013b6a0dd1b7b43699b39f8bb737d785f93115a34db580d781d", "ref_doc_id": "cb0da17b-71fb-4820-8b80-188bccf29b5e"}, "2839863e-030f-4b4d-a6cd-14603febb442": {"doc_hash": "2b9938b9900280880603f0a03c59d3b78ad5d7da3e60e932a41142448355d7ed", "ref_doc_id": "0435041d-c9ef-4eb1-9b39-a907d02384fc"}, "306bf6c5-26af-4d71-8cd3-9c955251f4dd": {"doc_hash": "ba7103e4ea89e7935bf70fc6dc645ea175d4aa8aa55da2871f7f1e431a2285ea", "ref_doc_id": "e21f8e32-57bd-4673-bbf1-868381c1b8fe"}, "b032bedb-664e-47ae-b868-8865031413c9": {"doc_hash": "bff813d3ff236542431706732e5a6567d603b210e0b0006156f1f0a205d5c26a", "ref_doc_id": "20899be0-7bb6-432e-aca4-523e402f5c06"}, "cd4d54ee-fe13-445f-ab46-ad8c9e14e33d": {"doc_hash": "2244d8f11f76fe87664863a0a49d695b72c53e3dd513cc7ade779cc01ab13249", "ref_doc_id": "d257f9ff-57fa-4031-b2f2-0656b3345edd"}, "d29cee82-e7a2-460d-886e-5e0bf4cd6f2f": {"doc_hash": "c1cb0a2998f39629240082e28a0f2dfe58c9a7b5ccf18e8e1956e094834c5a57", "ref_doc_id": "93c933e3-1f25-45ef-9d39-ad622f69e126"}, "2b8ff910-07ea-4243-bfc8-b5b86b4aac20": {"doc_hash": "a1baa116df2c1a2e8d2afa44d98d19b9d9b505fd083eec1b78e775ceb3c1dd5c", "ref_doc_id": "0d3592d4-6aa8-4700-8c69-77087c11060c"}, "b86d9017-074e-4a8c-af4b-04901d17dc3a": {"doc_hash": "91c37095f8789fcbe637a916e774ba7004016c4d3a1cbadfa5104b72f10ccaa3", "ref_doc_id": "6882b8ec-6e55-45c7-b489-7ac2ba1f3488"}, "c03b3fd3-9898-4f6f-8f83-9f9f38e72f44": {"doc_hash": "336c0f82b5e9dab9b8b4bd6385f9778ff5ee13690ff9f2d680c83399a1b83581", "ref_doc_id": "bae8eb49-a2c5-46f1-b4ca-52407bc5c4a1"}, "f26bf9e3-307f-4dce-a900-0c1a2a7299ac": {"doc_hash": "ff1f1c77793e5ac82a915f9aa2fd45b7bf4ac4661201102b943b866837389c5d", "ref_doc_id": "707987a8-0c39-47b7-94d1-9663fa24b198"}, "f5885ab4-fcd5-427d-8db1-ac96e2ee5a6c": {"doc_hash": "c25c8edbaaaf68044b891f828b4e416096ea5b17ed047129a0fcacd379051e44", "ref_doc_id": "3ef385b5-8499-4b8f-bf7c-44100a4762a6"}, "9c22cf27-a2e1-4b70-8d48-e07e45948111": {"doc_hash": "500892f44e905c113626d96caabfb15317bfe274102c290a6c4de6768bd8f9a8", "ref_doc_id": "b75f3b15-933c-4b74-8b49-c7f9042e2149"}, "aba5af4a-4bc7-47d7-a50a-5a3038f32571": {"doc_hash": "008e36d9d29f826e701b4fc47b5107d83107bbab67761f687ea117d1aa53ecfa", "ref_doc_id": "a81c6658-672d-41b7-8961-12fd3ce171d0"}, "1ad1dad3-510e-4df4-a338-ba9e9b91e5f8": {"doc_hash": "ceef9ffaba1320ba0ea39b985df66ebdc0c9f673ac17ce3a5303690c6145fe1f", "ref_doc_id": "e8cf0a5a-bf22-4d0f-92f3-f3de3bdb9fc1"}, "754c275b-fab4-48cd-b474-3ec6f9e46ffa": {"doc_hash": "9d34861c4eb5ce80836251ace57c2acdf448742f7d5edba5fca5732cb9672902", "ref_doc_id": "e0e94bd9-aefb-47aa-8195-61507e4b77b2"}, "375a97ee-7c38-4109-a767-04be4d3835a9": {"doc_hash": "3f7e90c98f442de69726611fe0dc7598d36ccf0eff35c90b4062243f0d1c7ca5", "ref_doc_id": "29defb66-e9ea-4784-be99-3eeba7203251"}, "89fcf935-501f-4ea5-9876-24b856646907": {"doc_hash": "369cfbe7a347f35eb4b4581c31e4903d6fccf9ca35e216108efd3d4b157daaa4", "ref_doc_id": "96498834-119d-4552-a4ce-fcb1e47fb499"}, "cbbc2423-4946-4bd2-9e0a-fb39a05b268d": {"doc_hash": "36c5aab85b7647309e9d9f8d5a67892475c6370b94ab98d69db89a496fd7e3ee", "ref_doc_id": "97291e4a-0512-49d5-bdc6-ff4fb59f6ee4"}, "e591bd5f-5f8a-437f-8b73-8f73f733810d": {"doc_hash": "a4f0a635e1b1b17fbb10bc4ae7ba18e10794eb10d45221ce23e37288fc98a924", "ref_doc_id": "eea54be3-50a9-4b54-a365-925aadb4a7e5"}, "59acf0e8-a38f-4f63-a1b2-9f3376c6aaed": {"doc_hash": "fc1f746d0081fd18b00ef65e941e75e7373f3f3d8d0697af1978143c7236093f", "ref_doc_id": "85fb42c9-7d17-4f14-bec1-af85400a4069"}, "95e77bcb-214b-4230-86f1-772fa9a2cc17": {"doc_hash": "0ba35ac21622deb20aa5f08605be002263efcb1ba1840c18bee7fb0f5da9512a", "ref_doc_id": "db618e43-6a7f-4e87-82a8-37232cd32937"}, "f164d191-adeb-4583-9c3f-4d60a10aae7d": {"doc_hash": "8eecd4e1791050bbc6ca43c2290d2e8d6c755cc1518848f57f09a91f22fe1f8e", "ref_doc_id": "352aeac5-eaca-435e-9d74-354004736df1"}, "efb8e075-2f66-4a57-972b-3733dd9d8486": {"doc_hash": "755f15c2b1cb118af8652c3091b44d3420a10f5470890018b3da6c9a94333f6b", "ref_doc_id": "4a3a1a13-78a1-4a26-964f-294ff14386fc"}, "3bb177f3-861b-4159-92f0-160e250b3fc2": {"doc_hash": "56d382e2c45de695d2add60ad035339984f420aa95b7ce31a1d0f18ffd596ebe", "ref_doc_id": "7bb116f6-1482-47cf-8c0b-5ff01e9de263"}, "5a71ba57-4505-4f5f-8598-a238e7c51ceb": {"doc_hash": "37f5c0757cf5d92a42a16bf5e4fa2f73dbd44e84de767f5d1187d698fbbe0e5f", "ref_doc_id": "32d5fd23-84ed-4d13-9938-cf101daf425a"}, "6c1e37f6-eec2-40e3-88ba-cb8bd0e2219e": {"doc_hash": "5058351fbaf00008888cedd8cafb88828cff1095981ca6d7f681f28dad8a46dc", "ref_doc_id": "369fd348-471b-4887-ad19-f02ddfeb684e"}, "4a4a1b59-f3eb-4fba-875c-042adb9d25d2": {"doc_hash": "8c539d4b071a43857cdba2034e6857e393f016a785071d1f70269fe71917de9a", "ref_doc_id": "0803b89a-0adf-4dab-9b17-68b99acfcf02"}, "e58c80c8-9e03-46f0-bf16-5529246b8ed0": {"doc_hash": "29dfbb4b10b1098486716af3301433abaa4e4497a9cd433703505680adc1dc0e", "ref_doc_id": "d2dd0f2c-3d39-414c-a7e0-a4cf7b3d0776"}, "35583672-d782-4acb-96c0-8e2ba52e4649": {"doc_hash": "c4009c09aa3b9f6a9d0db40cd0da90a91f3a69b0401cca67af8915d4dfb85dc9", "ref_doc_id": "6224201b-4efd-42a0-9cef-0946e4fe84e2"}, "8c2f7bdb-0383-4a2d-9b05-cac3b05f6061": {"doc_hash": "4c5cb864d6f613f120deec2700bd6ccc6c7341aefd42caf31d6e4c5161b8a880", "ref_doc_id": "44b5c628-e4cf-4b05-a77a-3b6353959098"}, "5f26c658-e98b-4588-bd44-31daf93b2af0": {"doc_hash": "febaf131872b92b5408d0a0f7d63821b65e48e564e3f1e0b37302973cc5a432f", "ref_doc_id": "b1619346-c4a4-4190-bacb-f7a0411ad965"}}, "docstore/data": {"99fd3556-5fc5-43f3-85bf-302baa3df818": {"__data__": {"id_": "99fd3556-5fc5-43f3-85bf-302baa3df818", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "27bfdc15-3f59-4992-8659-4b532ba28f77", "node_type": "4", "metadata": {}, "hash": "0867c77b35eeb1450cb63a129da73e5e971535d9a32cf3922811b9e1c130905b", "class_name": "RelatedNodeInfo"}}, "text": "# Driver Positioning and Incentive Budgeting with an Escrow Mechanism for Ridesharing Platforms\n\n# Hao Yi Ong, Daniel Freund, Davide Crapis\n\n# May 3, 2021\n\n# Abstract\n\nDrivers on the Lyft rideshare platform do not always know where the areas of supply shortage are in real time. This lack of information hurts both riders trying to find a ride and drivers trying to determine how to maximize their earnings opportunity. Lyft\u2019s Personal Power Zone (PPZ) product helps the company to maintain high levels of service on the platform by influencing the spatial distribution of drivers in real time via monetary incentives that encourage them to reposition their vehicles. The underlying system that powers the product has two main components: (1) a novel \u201cescrow mechanism\u201d that tracks available incentive budgets tied to locations within a city in real time, and (2) an algorithm that solves the stochastic driver positioning problem to maximize short-run revenue from riders\u2019 fares. The optimization problem is a multiagent dynamic program that is too complicated to solve optimally for our large-scale application. Our approach is to decompose it into two subproblems. The first determines the set of drivers to incentivize and where to incentivize them to position themselves. The second determines how to fund each incentive using the escrow budget. By formulating it as two convex programs, we are able to use commercial solvers that find the optimal solution in a matter of seconds. Rolled out to all 320 cities in which Lyft operates in a little over a year, the system now generates millions of bonuses that incentivize hundreds of thousands of active drivers to optimally position themselves in anticipation of ride requests every week. Together, the PPZ product and its underlying algorithms represent a paradigm shift in how Lyft drivers drive and generate earnings on the platform. Its direct business impact has been a 0.5% increase in incremental bookings, amounting to tens of millions of dollars per year. In addition, the product has brought about significant improvements to the driver and rider experience on the platform. These include statistically significant reductions in pick-up times and ride cancellations. Finally, internal surveys reveal that the vast majority of drivers prefer PPZs over the legacy system.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2333, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "f652ff15-f4f9-4144-b18f-b43dd2473816": {"__data__": {"id_": "f652ff15-f4f9-4144-b18f-b43dd2473816", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "3888170d-5508-4326-85f4-e9f7a8471b80", "node_type": "4", "metadata": {}, "hash": "bc5f7514f2b00f508731dec7d32efeeb0af0fee031e3b0196fcae238a676937e", "class_name": "RelatedNodeInfo"}}, "text": "# Contents\n\n# 1 Introduction\n\n4\n\n# 2 Problem Background\n\n6\n\n# 2.1 Cherry-picking of Long/Short Rides\n\n7\n\n# 2.2 Spatiotemporal Volatility\n\n7\n\n# 2.3 Spatial Volatility\n\n8\n\n# 2.4 Coordination\n\n8\n\n# 2.5 Limitations in the Legacy System\n\n8\n\n# 3 Product Description\n\n9\n\n# 4 Implementation Challenges\n\n9\n\n# 4.1 Repositioning\n\n9\n\n# 5 Stochastic Model\n\n11\n\n# 5.1 Supply\n\n11\n\n# 5.2 Demand\n\n11\n\n# 6 Optimization Approach\n\n12\n\n# 6.1 Budgeting Via a Location-based Escrow Mechanism\n\n12\n\n# 6.2 Problem Decomposition and Certainty Equivalent Approximation\n\n13\n\n# 6.3 Sequential Algorithm\n\n14\n\n# 6.4 Driver Positioning\n\n14\n\n# 6.5 Incentive Computation\n\n16\n\n# 7 Numerical Experiments\n\n16\n\n# 7.1 Data\n\n16\n\n# 7.2 Benchmarking Simulation\n\n16\n\n# 8 Live Experiments\n\n18\n\n# 8.1 Causal Inference Framework\n\n18\n\n# 8.2 Live Experiments: Results\n\n21\n\n# 9 Broader Impact\n\n22\n\n# A Optimization Approach\n\n26\n\n# A.1 The Model\n\n26\n\n# A.1.1 Order dispatch\n\n26\n\n# A.1.2 Price modifiers and elasticity\n\n27\n\n# A.1.3 Driver allocation\n\n27\n\n# A.1.4 Supply dynamics\n\n27\n\n# A.1.5 Escrow budgeting\n\n28", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1060, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "0ba16b7d-948e-4ba2-8b17-1f072eb1ab99": {"__data__": {"id_": "0ba16b7d-948e-4ba2-8b17-1f072eb1ab99", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "d40fbb26-d7a8-4d3e-a2d0-3e472a150254", "node_type": "4", "metadata": {}, "hash": "0f6868dcdca25630ae0aa6ce9340e0730e4a4e12ec47273cc4c8b04f2d88cdaa", "class_name": "RelatedNodeInfo"}}, "text": "# A. Driver Positioning\n\n# A.2 Driver Positioning\n\n28\n\n# A.3 Incentive Computation\n\n29\n\n# A.4 Practical Implementation Details\n\n29\n\n# A.4.1 Convexification\n\n30\n\n# A.4.2 Allocation vectorization\n\n30\n\n# A.4.3 Location pruning\n\n30\n\n# B. Perturbation and Sensitivity Analysis\n\n# B.1 The Perturbed Problem\n\n31\n\n# B.2 Local Sensitivity Analysis\n\n32\n\n# B.3 Global Sensitivity Analysis\n\n33\n\n# C. Video of PPZs Served in Production\n\n34", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 426, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "eb4dbd72-5035-42a4-8a77-a7216c260855": {"__data__": {"id_": "eb4dbd72-5035-42a4-8a77-a7216c260855", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "1117bc87-6ef8-452e-9754-9671a2ebb9ed", "node_type": "4", "metadata": {}, "hash": "2bc924de312e4431c0d51e17a97656a382e9f2cc7bf1b9e3c2b7ec95b295ffc5", "class_name": "RelatedNodeInfo"}}, "text": "# 1 Introduction\n\nLyft, Inc. develops and operates a mobile application (app), offering a ridesharing platform, as well as motorized scooter and bicycle sharing services. The company is based in San Francisco, California and operates in 320 cities in the United States and Canada. The biggest and most mature part of its business is ride sharing, a marketplace in which riders are matched in real time to drivers who drive them to their destinations. Our work seeks to incentivize the improved spatial positioning of drivers, so that drivers might better meet rider demand. The work was conducted with Lyft\u2019s Driver Positioning team, a cross-functional team of product managers and designers, software engineers, and research scientists that work as a unit to tackle problems related to the supply side of the market and develop products to improve this side of the marketplace.\n\nIn this paper, we describe the development of Lyft\u2019s Personalized Power Zone (PPZ) product. PPZ is an innovation that Lyft introduced to improve the drivers\u2019 experiences during peak demand periods. Historically, ride-hailing platforms have focused on dynamic pricing to match rider demand to available driver supply, charging higher prices during periods of heightened demand. Lyft calls its dynamic-pricing product \u201cPrime Time\u201d (PT) and Uber calls its equivalent \u201cSurge.\u201d These are multiplicative modifiers on top of the base time-and-distance fare, thereby reactively suppressing rider demand through marked-up fares. For drivers, both platforms have traditionally used heatmaps, which show the magnitude of elevated ride fares as colors on city maps as a visual aid to indicate locations with elevated demand; see the left subfigure in Figure 1. Since the driver\u2019s PT bonus in the legacy system was proportional to the ride\u2019s base fare and the PT multiplier, heatmaps serve as an incentive that drivers can use to reposition themselves toward areas with high PT multipliers [LFK18].\n\nGenerally, dynamic pricing provides a high earning potential for drivers, especially around persistent heatmap \u201chotspots,\u201d which are zones on the city map with elevated prices. In a commission-based platform system, drivers benefit from the rides\u2019 higher prices (i.e., higher $/minute spent driving a passenger). In addition, greater demand can give rise to greater driver utilization (i.e., minutes spent driving passengers/total minutes driving), as long as the time drivers spend per ride does not increase due to increased pick-up times, often referred to as estimated time of arrival (ETA) [CKW17]. Nonetheless, prior to the implementation of PPZs, the driver experience in peak demand periods was never optimized for drivers. Although some evidence exists showing that drivers react to the heatmap [LFK18], the predominant wisdom among drivers has been that actively chasing heatmap hotspots is not a good strategy to maximize earnings [Gri17]. In large part, this is motivated by the unpredictable and fast-paced updates of PT levels set by dynamic pricing algorithms that adapt rapidly to changes in the marketplace (see Figure 2). The goal of PPZs was to replace the driver\u2019s PT heatmap and adapt the drivers\u2019 compensation during PT in a manner that simultaneously incentivizes improved driver positioning within a city and the drivers\u2019 experience by more directly rewarding the positioning effort.\n\nReplacing the driver PT product required a significant shift to Lyft\u2019s ride-hailing platform design. For example, it involved deviating from a fixed in-ride, on-trip commission-based model that pays the driver a constant fraction of the rider\u2019s PT surcharge. This change was", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3650, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "6a4ca8c1-d51a-4f6c-9cde-1361f7654247": {"__data__": {"id_": "6a4ca8c1-d51a-4f6c-9cde-1361f7654247", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "cb0da17b-71fb-4820-8b80-188bccf29b5e", "node_type": "4", "metadata": {}, "hash": "53b2b2a6bc67e013b6a0dd1b7b43699b39f8bb737d785f93115a34db580d781d", "class_name": "RelatedNodeInfo"}}, "text": "# 2-47 PM\n\n# Iya Drive mode\n\n# PRIME TIME\n\n# 25757 MORE\n\nEarn a ride bonus\n\nEnter the zone earn a bonus on your next ride\n\n# Navigate\n\nFigure 1: PT adds a predetermined percentage of the base fare onto the driver\u2019s total fare (left), whereas drivers accrue a Personal Power Zone bonus when they enter the corresponding zones (right).\n\nnecessary to improve upon the shortcomings of the driver PT experience, which we outline in additional detail below. However, beyond this design change, it also required significant algorithmic innovations. Our paper highlights these algorithmic innovations and the results they produced. The two key algorithmic developments that we describe are as follows.\n\n- A robust spatial budget-tracking mechanism that provides real-time demand signals, which we discuss in the Budgeting Via a Location-Based Escrow Mechanism subsection.\n- An asymptotically optimal two-stage algorithm that produces driver relocation incentives to maximize market efficiency, which we describe in the Problem Decomposition and Certainty Equivalent Approximation subsection.\n\nBeyond the change to Lyft\u2019s platform, the PPZ development also deviated significantly from the ideas traditionally considered in the academic study of the gig economy. In these works, the focus has usually been on the platform taking a constant proportion of each trip\u2019s fare, including the PT portion. Only recently have Garg and Nazerzadeh [GN21] considered a stylized model that exposes fundamental limitations that arise with a multiplicative PT bonus due to the fast-paced changes in the levels of dynamic rider prices often observed in the market. (Note that Garg and Nazerzadeh was originally written in 2019 and was updated in 2021.) To the best of our knowledge, all prior work had either explicitly (e.g., [BJR15], [BCS16], [CDL17]) or implicitly (e.g., [MFP19]) considered models in which the drivers\u2019 bonus was a constant proportion of the rider\u2019s PT. In contrast to Garg and Nazerzadeh [GN21],\n\n5", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1994, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "2839863e-030f-4b4d-a6cd-14603febb442": {"__data__": {"id_": "2839863e-030f-4b4d-a6cd-14603febb442", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "0435041d-c9ef-4eb1-9b39-a907d02384fc", "node_type": "4", "metadata": {}, "hash": "2b9938b9900280880603f0a03c59d3b78ad5d7da3e60e932a41142448355d7ed", "class_name": "RelatedNodeInfo"}}, "text": "# Prime Time markup over time\n\n|Time|Location|Location|Location|\n|---|---|---|---|\n|18:45:00|160|160|160|\n|19:00:00|140|140|140|\n|19:15:00|120|120|120|\n|19:30:00|100|100|100|\n|19:45:00| | | |\n|20:00:00| | | |\n|20:15:00| | | |\n|20:30:00| | | |\n\nFigure 2: PT bonus multiplier values plotted for three nearby locations illustrate how spatially and temporally volatile they can be over a short time span.\n\nWe describe a real-world implementation of a system that considers this concern and others, which we describe in the Problem Background section.\n\n# 2 Problem Background\n\nWe structured the remainder of this paper as follows. In the Problem Background and Product Description sections, we discuss the shortcomings of the legacy system and the PPZ product design. We describe the key technical challenges to overcome when implementing PPZs in Technical Implementation Challenges. In the Stochastic Model and Optimization Approach sections, respectively, we describe the theoretical model that motivated our algorithmic approach and the approach. In Implementation, Numerical Experiments, and Live Experiments, we outline the challenges that arose in measuring the business impact of the new system and the causal inference approach we developed to overcome them. We conclude with a discussion of the impacts these innovations enabled in the Broader Impact section. In the appendices, we provide a formal description of the technical challenge and our optimization model. The algorithms we present are currently deployed at Lyft in the 320 cities in which we operate. Their cumulative impact has included an increase in yearly bookings by tens of millions of dollars and a reduction in driver cancellation rates by 13%. Every week, these algorithms generate millions of PPZs that help hundreds of thousands active drivers decide where to drive.\n\nWe begin by discussing the limitations of the legacy driver PT system. The papers most similar to ours focus on the problem of setting prices to incentivize drivers to relocate toward high-earning opportunities. The key component the literature misses, to the best of our", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2115, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "306bf6c5-26af-4d71-8cd3-9c955251f4dd": {"__data__": {"id_": "306bf6c5-26af-4d71-8cd3-9c955251f4dd", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "e21f8e32-57bd-4673-bbf1-868381c1b8fe", "node_type": "4", "metadata": {}, "hash": "ba7103e4ea89e7935bf70fc6dc645ea175d4aa8aa55da2871f7f1e431a2285ea", "class_name": "RelatedNodeInfo"}}, "text": "knowledge, is the significant and unpredictable spatial and temporal volatility of rider PT. To keep supply and demand in balance in a fast-paced market such as ride-hailing, the platform frequently updates its prices; for example. Uber updates its prices every two minutes [LFK18]. Consider the time series plot of the PT bonus multiplier levels in three busy nearby locations (i.e., within a mile apart) in the greater San Francisco Bay Area, as we show in Figure 2. Although the price-setting algorithm enforces some level of spatiotemporal smoothness, market conditions and thus PT bonus multiplier values change rapidly across time and space. In addition, the direction and magnitude of the changes are unpredictable. This holds true for platform designers with full information, and even more so for drivers with less information. Thus, common assumptions around drivers being rational agents with full information fail to capture the uncertainty inherent in the driver\u2019s decision-making process. Below, we describe these complications and how we designed PPZs to overcome them.\n\n# 2.1 Cherry-picking of Long/Short Rides\n\nGarg and Nazerzadeh [GN21] show that drivers may cherry-pick long rides during PT periods and short rides during non-PT periods to maximize their earnings using the legacy system. They consider a two-state Markovian system in which the state characterizes whether the current rider price is either low or high (i.e., the dynamic pricing is abstracted to being only a binary state). A driver receives a stream of ride requests of different trip lengths; the state of the system determines the rate at which the driver receives requests and the pay per minute and per mile of driving. The driver\u2019s policy is to pick the set of requests to accept in each state. The main insight of Garg and Nazerzadeh is that by making the bonus for PT rides additive, rather than proportional to the trip length, the platform induces the driver to accept a larger set of trips. Intuitively, this is because accepting a short trip during surge periods may provide only a small earnings boost if the bonus is proportional to the (short) trip; yet, at the end of the trip, the surge period with its elevated opportunities may be over. Furthermore, they show (in their Theorem 3) that a bonus that is an affine function of the trip length is the best the platform can do to incentivize drivers to accept as many trips as possible. Although this constitutes a significant conceptual contribution toward an understanding of the fundamental limitations that arise under the legacy model, their stylized model does not give rise to a practical algorithm to overcome these shortcomings. Beyond implementing a product that capitalizes on their main insights, PPZ also addresses the following concerns that are not captured in the Garg and Nazerzadeh [GN21] model.\n\n# 2.2 Spatiotemporal Volatility\n\nAs we show in Figure 2, PT is not only volatile in time but also in space. In particular, because different regions within a city experience different supply-demand imbalances, the platform prices rides differently across locations. Such spatial differences in prices are widely captured in the literature; examples include Bimpikis et al. [BCS16], Afeche et al. [ALM18], and Ma et al. [MFP19]. However, the literature does not account for the interplay between spatial and temporal volatility. Specifically, between the time a driver sees prices induced by", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3455, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "b032bedb-664e-47ae-b868-8865031413c9": {"__data__": {"id_": "b032bedb-664e-47ae-b868-8865031413c9", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "20899be0-7bb6-432e-aca4-523e402f5c06", "node_type": "4", "metadata": {}, "hash": "bff813d3ff236542431706732e5a6567d603b210e0b0006156f1f0a205d5c26a", "class_name": "RelatedNodeInfo"}}, "text": "# 2.3 Spatial Volatility\n\nAbove we illustrated how temporal volatility discourages drivers from spatially repositioning. However, spatial price volatility also affects drivers who are already in an area where prices are high. Recall that under the legacy system, drivers earn a direct cut of the fare paid by the rider. In that world, a driver may encounter situations in which he/she is idling in a high-PT location and yet is dispatched to a nearby location with lower (or even no) PT. Ironically, the high PT at the driver\u2019s location may dissuade a customer in that location from requesting a ride. Thus, the request-suppressing effect of PT may cause the driver to experience a smaller PT bonus and a longer ETA to serve the ride.\n\n# 2.4 Coordination\n\nFinally, many papers in the ridesharing context, including Ma et al. [MFP19], Castro et al. [CBL18], Afeche et al. [ALM18], Yang et al. [YIF18], and Bimpikis et al. [BCS16], assume different forms of spatial equilibria arising from drivers selfishly optimizing their own earnings. In practice, it is difficult to imagine how such equilibria would emerge in a dynamic system without agents having the ability to observe the actions of other drivers. Consider a group of drivers trying to reposition toward two different locations with PT. Even if they coordinated on the number of drivers to reposition to each location, they would need to make this decision based only on the observed PT levels. Because these would roughly correspond to relative supply shortfall, and not to absolute supply shortfall (see Price modifiers and elasticity in Appendix A: Optimization Approach), successful coordination is extremely unlikely.\n\n# 2.5 Limitations in the Legacy System\n\nIn summary, despite providing drivers with higher earnings opportunities, the legacy system had misalignments between (1) the drivers\u2019 earnings maximization behaviors, (2) the behaviors the platform incentivizes (e.g., repositioning toward PT), and (3) the driver behaviors that would maximize platform metrics, such as number of rides served. Cumulatively, these led to both a poorer driver experience and platform inefficiencies. Noticeably, these issues could not have been addressed through mere algorithmic improvements to dynamic pricing. For example, they could not be resolved through a better forecast of riders\u2019 willingness to pay, or a change in the optimization problem underlying the price-setting process. Instead, a", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2451, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "cd4d54ee-fe13-445f-ab46-ad8c9e14e33d": {"__data__": {"id_": "cd4d54ee-fe13-445f-ab46-ad8c9e14e33d", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "d257f9ff-57fa-4031-b2f2-0656b3345edd", "node_type": "4", "metadata": {}, "hash": "2244d8f11f76fe87664863a0a49d695b72c53e3dd513cc7ade779cc01ab13249", "class_name": "RelatedNodeInfo"}}, "text": "# 3 Product Description\n\nThe goal of the PPZ project was to optimize the PT experience for drivers by channeling the riders\u2019 PT payments to drivers in a way that would resolve the limitations above and thereby improve the platform\u2019s market metrics (e.g., bookings and driver hours); see the Live Experiments: Results subsection below. From the driver\u2019s perspective, a PPZ incentive consists of a delimited geographic area associated with a fixed, visible bonus. The driver qualifies for the bonus when entering the area and receives it upon completing his/her next ride request; the right side of Figure 1 shows the PPZ driver interface, including the bonus the driver accrues upon entering the purple/pink PPZ zone. By providing a clear reward for an unambiguous action, PPZ removes the uncertainty in the legacy system and thus creates an effective nudge for drivers to reposition. Beyond removing the issues surrounding uncertainty, globally optimizing the incentives given to drivers across a city also allows the PPZ product to globally coordinate the drivers\u2019 locations. In addition, as PPZ replaces the proportional PT bonus of the legacy system, the driver may also receive an after-ride adjustment to ensure that the gap between the rider\u2019s fare and the driver\u2019s earnings is not excessively large. The additive upfront bonus experience, in conjunction with such after-ride adjustments based on time and distance, are similar to the affine bonuses suggested by Garg and Nazerzadeh [GN21] and thus partially address the issues of drivers strategically rejecting trips to boost their earnings or cherry-picking their rides.\n\n# 4 Implementation Challenges\n\nA successful implementation of PPZs had to address two key technical challenges. First, PPZ would need to incentivize a better positioning of drivers than the legacy system. Second, the total amount of money spent on the PPZ incentives should match its budget (i.e., the PT paid by riders). In the following subsections, we describe these challenges and our initial attempts to overcome them.\n\n# 4.1 Repositioning\n\nWithin any city in which Lyft operates, a set of drivers, referred to as open drivers or open supply, is available for dispatch. PPZs encourage open drivers to reposition to a different location by offering a monetary incentive at that location. The previous approach to incentive-based repositioning was based on the marginal value of supply in all spatial units of the city. Value can refer to rider request conversions or to the revenue they represent. This concept, which we refer to as the local sensitivity approach, was to incentivize drivers to reposition from one location to another if a significant differential in the marginal value of supply between the two locations existed.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2766, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "d29cee82-e7a2-460d-886e-5e0bf4cd6f2f": {"__data__": {"id_": "d29cee82-e7a2-460d-886e-5e0bf4cd6f2f", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "93c933e3-1f25-45ef-9d39-ad622f69e126", "node_type": "4", "metadata": {}, "hash": "c1cb0a2998f39629240082e28a0f2dfe58c9a7b5ccf18e8e1956e094834c5a57", "class_name": "RelatedNodeInfo"}}, "text": "# Figure 3\n\nThe graph shows the marginal value of supply evaluated at some location, as the highly nonlinear, step function-like empirically-fitted (solid) and theoretical (dashed) curves illustrate.\n\nUnfortunately, the local nature of the approach did not account for the highly interactive nature of incentivizing a large number of drivers to reposition within a city. Implicitly, the local-sensitivity approach assumes that the local approximation (i.e., the gradient of our value function with respect to supply) provides a good indication of the market state even when it is perturbed by incentivizing many drivers to move simultaneously. This was a poor assumption. In practice, we observed that although the gradient evaluated at the current market state is accurate in the case of a small change in supply, incentivizing a large number of drivers to move breaks the locality assumption. The marginal value of supply is highly nonlinear and drops steeply beyond a specified supply count. Figure 3 shows an example of a location at which the nonlinearity is exhibited in both the empirically observed (solid line) and theoretically computed marginal values (dashed line). The steep drop in value appears when the supply count matches the number of ride requests at the location.\n\nIn Appendix B: Perturbation and Sensitivity Analysis, we prove that not only is the local sensitivity analysis largely invalid, but the decisions also made based on this approach can hurt market conditions.\n\nBecause PT is based on a multiplicative price markup on top of the eventual time-and-distance-based trip fare, the source of our budget is dynamic and is only fully realized after a ride has been completed. Specifically, we cannot know the value of the ride fare that funds the PPZ bonus until much later when the ride has been completed, or at least requested. To encourage a driver to reposition toward better ride opportunities, we must offer a PPZ bonus before the ride, which is intended to fund the PPZ bonus. This chicken-or-egg problem was at the source of PPZ\u2019s budget-control challenge.\n\nIn the initial marginal-value-of-supply approach, the bonuses were paid as an affine function of the marginal value. Unfortunately, these bonus values often grossly overestimated", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2270, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "2b8ff910-07ea-4243-bfc8-b5b86b4aac20": {"__data__": {"id_": "2b8ff910-07ea-4243-bfc8-b5b86b4aac20", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "0d3592d4-6aa8-4700-8c69-77087c11060c", "node_type": "4", "metadata": {}, "hash": "a1baa116df2c1a2e8d2afa44d98d19b9d9b505fd083eec1b78e775ceb3c1dd5c", "class_name": "RelatedNodeInfo"}}, "text": "The available funds, leading to overspending of up to 15 times our budget at times. This was in large part because the marginal value is a poor measure of the incremental revenue we can derive from the market. The spending problem became so severe that market degradation forced us to roll back the PPZ product from a major city in which we had already launched it [Smi18]. If we were to eventually scale the product to all 320 cities, we had to develop a much more robust way to control spending.\n\n# 5 Stochastic Model\n\nIn this section, we describe a stochastic model that motivated our eventual optimization approach. The model is based on a multistage stochastic process on a discrete network of locations. Below, we outline the steps in each stage. We begin by describing what is assumed to be known at the beginning of the first stage. Initially, we know for each location i the current number of idle drivers and the expected demand. In addition, we know for any two locations i and j (1) whether we can dispatch a driver from i to serve demand in j, and (2) the response probability of a driver in i to relocate to j (i.e., the probability that a driver will relocate from i to j when a PPZ incentivizes that driver to do so). Finally, for each location we have a current budget estimate. We provide details in the Budgeting Via a Location-Based Escrow Mechanism subsection below.\n\n# 5.1 Supply\n\nBased on the above information, we must determine the set of drivers to whom we will provide an incentive to relocate, and the destination to which we want these drivers to relocate. In doing so, we are constrained to not overspend the budget. Each driver who is given an incentive makes a stochastic decision whether to reposition based on that driver\u2019s present location and the incentivized destination.\n\n# 5.2 Demand\n\nAfter the drivers relocate, the platform sets the PT price markups based on the new driver locations and the forecast demand. The prices are set as part of an optimization problem to maximize a metric, which we refer to as no-PT bookings. This metric captures the time-and-distance fare of all serviced ride requests but does not include the PT markups. The no-PT bookings metric is one of Lyft\u2019s most important metrics because it captures revenue without rewarding markets with mismatched supply and demand. For example, when including PT, bookings may be higher in the short run due to extreme PT markups; however, these are often perceived as detrimental to rider retention in the long run. Thus, no-PT bookings is the main metric we aim to maximize with PPZs. The constraints of the underlying optimization problem ensure that the expected number of ride requests, suppressed by the PT price markups, does not deplete the supply beyond a reserve level that ensures that ETAs remain acceptably low [CKW17]. After the platform sets its prices, we model the", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2882, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "b86d9017-074e-4a8c-af4b-04901d17dc3a": {"__data__": {"id_": "b86d9017-074e-4a8c-af4b-04901d17dc3a", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "6882b8ec-6e55-45c7-b489-7ac2ba1f3488", "node_type": "4", "metadata": {}, "hash": "91c37095f8789fcbe637a916e774ba7004016c4d3a1cbadfa5104b72f10ccaa3", "class_name": "RelatedNodeInfo"}}, "text": "# 6 Optimization Approach\n\nIn this section, we provide a high-level overview of the methods we use to solve the problem described in the Stochastic Model section above. As part of the solution, we also describe a novel escrow mechanism used to generate budgetary signals for our algorithm. We provide a technically rigorous and detailed discussion of our approach in Appendix A: Optimization Approach.\n\n# 6.1 Budgeting Via a Location-based Escrow Mechanism\n\nOur second key challenge was to spend a highly dynamic budget before we collect it. Recall the budget materializes only upon ride completion via rider PT payments. This dynamic budget is also highly location dependent because demand levels can vary significantly across a city. Given the delay between the time at which we must spend and the time at which the budget is realized in our accounts, we would like to accurately predict when and where the budget income may materialize; however, due to the spatiotemporal volatility of PT, doing so is impossible. To circumvent this conundrum, our key insight was that fast, real-time data based on upfront fares at ride dispatch can substitute for good predictions. Intuitively, we treat the PT paid by riders as part of our budget at the time and place of the ride request and dispatch despite the risk of the ride still being canceled or the PT amount changing because the rider changes the origin or destination. Upon completion of the trip, we then correct for the difference in amount that was realized. We note that although ride requests are a lagging indicator for future demand, we know empirically that rider demand (and the elasticity of demand) is generally well-correlated in the same location within a reasonably short time duration. Thus, as long as we can spend the budget accumulating from upfront fares quickly, the location of incoming PT across the city at any point in time will provide a good indication of where we should provide PPZs.\n\nTo track how much to spend and therefore how much money to offer per incentive, we create a set of virtual accounts associated with the locations from which ride requests originate. We call these virtual accounts a city\u2019s \u201clocal accounts.\u201d The escrow mechanism updates in response to events such as when a driver receives a PPZ or accepts a ride request and when a rider cancels a ride request or is dropped off at the ride destination. The occurrence of these events correspond to when and where we can account for the estimated and actual financial transactions, which determine the portions of the PT income earmarked for PPZ spend and the PPZ spend itself. As these events occur, we actively update the balance of the location-based escrow accounts in real time.\n\nPT income is attributed to the local account corresponding to the location at which the ride request originates. Based on the repositioning optimization, PPZ expenditure is", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2904, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "c03b3fd3-9898-4f6f-8f83-9f9f38e72f44": {"__data__": {"id_": "c03b3fd3-9898-4f6f-8f83-9f9f38e72f44", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "bae8eb49-a2c5-46f1-b4ca-52407bc5c4a1", "node_type": "4", "metadata": {}, "hash": "336c0f82b5e9dab9b8b4bd6385f9778ff5ee13690ff9f2d680c83399a1b83581", "class_name": "RelatedNodeInfo"}}, "text": "# PPZ creation\n\nWhen driver is assigned PPZ, the Bonus accrual accounts corresponding to the PPZ destination decreased the contribution of the account towards the cost of the incentive:\n\n|Rider intent|Ride request|\n|---|---|\n|app-open; high request intent generate expected PT budget that added to the accounts that correspond to ride request origins:|While the driver accrues money in their expected balances the tagged payout accounts balances decrease as the expected payout increases due to the increased probability of PT income:|\n\n|Ride accept|Ride completed|\n|---|---|\n|PPZ bonus \"locked-in\" expenditure for tagged accounts:|After the rider is dropped off; the \"fully realized\" PPZ payout and PT budget are substituted for the estimates that previously adjusted the balances in the accounts:|\n\nFigure 4: A sample timeline illustrates how riders generate escrow account balances that allow PPZs to be generated and served to encourage drivers to reposition. Note that these sample events illustrate how the escrow accounts are updated for expected incoming budget and payouts and eventually \u201crealized\u201d as finalized account balances.\n\nAttributed to a set of local accounts corresponding to the PPZ destination. A subtlety is that PT income is attributed to a single account whereas PPZ expenditure can possibly be attributed to multiple accounts near the PPZ destination. The reason for this is that the driver who reaches a PPZ destination may subsequently be dispatched to pick up riders in locations close to the destination as well as those in the destination location. Thus, pooling multiple account balances to motivate the driver to reposition is appropriate. Although the full set of events causing updates to the account balances is too numerous to list, Figure 4 gives an intuitive illustration of how riders and drivers typically interact with the platform and consequently induce escrow account balance changes.\n\nAs we explain above, we want to avoid accumulating money in the accounts (as opposed to spending it in real time); to avoid this, the PPZ bonus amounts offered are set to equal approximately the ratio of the available balance in the accounts to the number of drivers who are expected to reposition to the locations tied to the local escrow accounts, given the PPZ incentive. They thus form a set of \u201caccount clearance targets\u201d that functions as a budgetary reference for an amount to spend at each time step of our PPZ allocation and bonus computation. Its purpose is to clear our accounts and avoid accumulating money. Such target spend signals from the escrow mechanism provide a safe way for PPZs to spend incoming PT money quickly without overspending. In addition, they serve as principled, location-based accounting signals for PPZ to incentivize drivers to reposition.\n\n# 6.2 Problem Decomposition and Certainty Equivalent Approximation\n\nThe problem described in the Stochastic Model section is a Markov decision process (MDP) that can theoretically be solved optimally; however, such an approach is impractical due", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3052, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "f26bf9e3-307f-4dce-a900-0c1a2a7299ac": {"__data__": {"id_": "f26bf9e3-307f-4dce-a900-0c1a2a7299ac", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "707987a8-0c39-47b7-94d1-9663fa24b198", "node_type": "4", "metadata": {}, "hash": "ff1f1c77793e5ac82a915f9aa2fd45b7bf4ac4661201102b943b866837389c5d", "class_name": "RelatedNodeInfo"}}, "text": "# 6.3 Sequential Algorithm\n\nFigure 5 illustrates how the escrow mechanism\u2019s account balances are updated (A) and entered into the pair of subproblems (B and C), which are then solved to obtain the PPZ allocations sent to drivers at each time step (D). First, in (A), PT income and PPZ payouts are distributed to and contributed from various escrow accounts depending on driver and rider events and the locations at which they occur. The escrow account updates occur in real time and the account balances are entered as parameters to the PPZ optimization subroutines. Then, in (B), the algorithm optimizes for the relocation of drivers to match the locations at which future rider requests are expected to originate while ignoring the exact payouts needed to incentivize drivers to reposition. In (C), the incentive computation subroutine produces actual bonus payout values for the PPZ to be given to each driver. Finally, in (D), PPZs are created to incentivize a subset of the idle drivers to reposition and better serve predicted rider requests. To maintain some level of parity between PT income and driver bonuses based on where the ride requests originate, we enforce an equal-split payout among all drivers guided to the same PPZ destination.\n\n# 6.4 Driver Positioning\n\nOur driver positioning subproblem is to maximize the expected revenue-weighted rider request \u201cconversions\u201d in the entire city. The key decision variable is the set of PPZ allocation fractions Aij \u2208 [0, 1] from some location i with open drivers to another location j. These allocation fractions tell us how many drivers we want to incentivize in any one location to reposition to another location (in a single decision period). More explicitly, for some driver", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1736, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "f5885ab4-fcd5-427d-8db1-ac96e2ee5a6c": {"__data__": {"id_": "f5885ab4-fcd5-427d-8db1-ac96e2ee5a6c", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "3ef385b5-8499-4b8f-bf7c-44100a4762a6", "node_type": "4", "metadata": {}, "hash": "c25c8edbaaaf68044b891f828b4e416096ea5b17ed047129a0fcacd379051e44", "class_name": "RelatedNodeInfo"}}, "text": "# Incentivize drivers reposition\n\nDetermine incentives for each PPZ. Escrow updates accounts as real-time events are processed to better match predicted rider demand within allocation neighborhood: allocation and corresponding Escrow account contributions for each PPZ.\n\nPPZs offered to some drivers and shown as pink/purple zone that is navigated to.\n\nFigure 5: The graphic shows a systemic view of the driver positioning and incentive computation subroutines, which are executed for a city to improve the spatial distribution of drivers and match rider demand.\n\nIn location i, we choose some destination out of all locations available j weighted by Aij (including the \u201cnull location\u201d in which we do not serve any PPZ).\n\nThe PPZ allocation fractions are set based on constraints on the service level, the dynamics of how drivers reposition vis-a-vis PPZ incentive allocations, and budgetary restrictions arising from the available escrow account balances. The service level constraint ensures that demand (subject to pricing) does not exceed supply in the location of the spatial neighborhood to which drivers may be dispatched. That is, in each location\u2019s \u201cdispatch neighborhood,\u201d the market is balanced by simultaneously inducing PT and accounting for the drivers incentivized to reposition.\n\nA notable aspect of the budgetary constraints is that although local account balances are aggregated and tagged to discrete locations, they are accessible to PPZ offers that guide drivers to any destination location within a spatial \u201ccontribution radius\u201d around the local account\u2019s location tag. This design choice for the escrow mechanism is motivated by the fact that upon reaching a specific PPZ destination, a driver can subsequently be dispatched to not only the destination location\u2019s riders but also to riders in nearby locations. The exact details are provided in Appendix A: Optimization Approach. Here, we simply highlight that this property allows us to make flexible allocation decisions; for example, we can serve forecast demand located near but not at the locations of existing demand.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2096, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "9c22cf27-a2e1-4b70-8d48-e07e45948111": {"__data__": {"id_": "9c22cf27-a2e1-4b70-8d48-e07e45948111", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "b75f3b15-933c-4b74-8b49-c7f9042e2149", "node_type": "4", "metadata": {}, "hash": "500892f44e905c113626d96caabfb15317bfe274102c290a6c4de6768bd8f9a8", "class_name": "RelatedNodeInfo"}}, "text": "# 6.5 Incentive Computation\n\nGiven the allocations from the driver positioning subroutine, the incentive computation subproblem attempts to set the monetary payout so that every driver sent to the same location is offered the same expected bonus. The rationale is as follows. The balances at each location represent the sum of the PT markups that each rider will pay for trips of different lengths. Although we cannot know which ride request will be dispatched to a driver at some location ahead of time, one fair approach is to average the expected PT income over all possible trips to which that driver can be dispatched from that location. This results in an even split of the expected PT income among drivers. One decision variable is thus the set of per-PPZ bonus values unique to each destination location. Another decision variable is the set of contribution fractions indicating the portion of the available balance in each escrow account to be set aside for every PPZ offer ending at some destination location. These decisions are constrained by simple lower and upper bounds on the range of permissible bonus values. An important constraint is that the expected expenditure resulting from drivers who respond to the PPZ instructions should not exceed the available budget.\n\n# 7 Numerical Experiments\n\nWe carry out numerical simulation using previous data in back-tests to exercise our algorithm in a safe nonproduction environment. The back-tests also enable us to plan for required computation resources and understand how the model handles specific scenarios, for example, how it handles peak and nonpeak commute periods or cities that clearly divide their downtown and suburban areas and those that do not.\n\n# 7.1 Data\n\nWe work with three months of data from cities (anonymized for confidentiality) that are representative of the diversity of the topographies of the cities in which we operate. We collect data for problem parameters from production logs. As a proxy for the account balances for which we do not have historical data, we assume that the system will always clear the account balances at each decision period. As a result, the balances available at each decision period come from the historical PT transactions from the previous period.\n\n# 7.2 Benchmarking Simulation\n\nWe consider a driver positioning and incentive budgeting strategy compared against a null allocation benchmark. The null allocation benchmark represents the legacy market conditions with the driver PT product without PPZ allocations. Rather than a comprehensive rollout of the PPZ model over a long time horizon, we consider only the results of our single-period model, as shown in Figure 6. Thus, our simulation cannot account for the cumulative impact of PPZs incentivizing the drivers\u2019 repositioning in previous time steps and will be biased toward returning higher-impact estimates.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2882, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "aba5af4a-4bc7-47d7-a50a-5a3038f32571": {"__data__": {"id_": "aba5af4a-4bc7-47d7-a50a-5a3038f32571", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "a81c6658-672d-41b7-8961-12fd3ce171d0", "node_type": "4", "metadata": {}, "hash": "008e36d9d29f826e701b4fc47b5107d83107bbab67761f687ea117d1aa53ecfa", "class_name": "RelatedNodeInfo"}}, "text": "# Rider sessions\n\n# Driver shifts\n\n# Conversions\n\n# Account balances\n\n# No-PT bookings\n\n# City topography\n\n# Simulation loop\n\n- Populate rider and drivers in the city\n- Compute problem parameters and solve mathematical programs\n- Simulate riders requesting for rides and drivers repositioning given PT price markups and PPZ allocations (skip for no-PPZ scenario), respectively; based on trained ML behavior models\n- Compute updated driver locations and supply state at next time step\n- Compute market metrics\n\nFigure 6: Initial market conditions are sampled and propagated for one time step to obtain performance metrics such as rider conversions and no-PT bookings.\n\nWe conduct back-test simulations for four cities, using two strategies that optimize for different objectives, namely, the rider request conversions and no-PT bookings. For each simulation, we give a relative version of the incremental objective value or return. We do not directly use the objective value from the optimization. Instead, we take the allocation results and enter them into a rudimentary simulator to obtain the performance metrics. The simulator employs a model fitted from historical data (e.g., idle behavior and dispatch likelihood) to determine the response of the drivers to the allocation guidance and the simulated return.\n\nTable 1 shows that the performance of the algorithm and hence product can vary significantly as the city changes. Empirically, cities that are less homogeneous in population density across the region tend to enjoy greater metric improvements (e.g., cities A and C in our simulations). Some examples are cities with sharp concentrations of demand at residential and office buildings at various times of the day. This often means that there are greater opportunities in incentivizing drivers to move between locations to improve the market balance. This observation is consistent with our goal of rewarding drivers that reposition themselves with PPZs.\n\nTo illustrate the above, Figure 7 plots the relative incremental gain results for City A based on the no-PT bookings maximizing algorithm. The distribution plot (left subfigure) shows a right skew in the incremental gains. This skew is due to our uniformly random sampling of periods causing our distributions to be dominated by lull periods, as opposed to demand peaks with greater repositioning opportunities (see Figure 8). We remark that the significant performance gains on the y-axis when the budget is extremely small can be explained by scenarios in which the driver count is low, such that only one PPZ with, for example, $3 can yield relative gains in rider request conversion of a few percentage points.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2681, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "1ad1dad3-510e-4df4-a338-ba9e9b91e5f8": {"__data__": {"id_": "1ad1dad3-510e-4df4-a338-ba9e9b91e5f8", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "e8cf0a5a-bf22-4d0f-92f3-f3de3bdb9fc1", "node_type": "4", "metadata": {}, "hash": "ceef9ffaba1320ba0ea39b985df66ebdc0c9f673ac17ce3a5303690c6145fe1f", "class_name": "RelatedNodeInfo"}}, "text": "|Objective| |City|Conversion| | |No-PT bookings|\n|---|---|---|---|---|---|---|\n| | | |Mean|Median|Mean|Median|\n| |Conversion|A|2.350%|1.504%|1.151%|0.622%|\n| | |B|0.758%|0.092%|0.222%|0.022%|\n| | |C|4.254%|2.009%|0.364%|0.075%|\n| | |D|0.905%|0.114%|0.426%|0.021%|\n| |No-PT|A|0.913%|0.499%|1.902%|1.179%|\n| | |B|0.205%|0.021%|0.705%|0.097%|\n| | |C|0.426%|0.064%|3.601%|1.450%|\n| | |D|0.346%|0.002%|0.466%|0.003%|\n\n# 8 Live Experiments\n\nWe ran a series of experiments with the twin goals of estimating the marketplace outcomes of our product and determining whether to launch it to all Lyft markets. In particular, we were interested in estimating the effect of our incentive-based supply positioning system on conversion, that is, the probability that if a potential rider opens the Lyft app, that opening becomes a Lyft ride. In the context of our marketplace, naive estimators suffer from network interaction or interference bias, which can result in estimates that differ significantly from actual effects, sometimes by an order of magnitude [Cha16]. We briefly introduce the techniques we used to circumvent this problem before presenting the results of our experiment.\n\n# 8.1 Causal Inference Framework\n\nThe most widely used causal inference technique to circumvent the problem of statistical interference in ridesharing platforms and marketplaces, including Lyft, is time-split or switch-back tests [XLG+18]. Treatment is randomly assigned by time interval (rather than user) so that all the users in the market in a given time interval belong to only one variant and the effect of interference is minimized. Unfortunately, we could not use switchbacks because (1) our product involved a major change to the user interface and switching back and forth between two substantially different experiences for the same user was not feasible, and (2) we wanted to measure the long-term effects of continuously exposing users to our product. For these reasons, we based our inferences on a driver-split experiment in conjunction with a model that we built and validated to correct for most of the interference bias.\n\nWe wanted to estimate how a change in the distribution of supply would affect the aggregate number of rides that can be dispatched on the platform. At the micro-scale, this is a function of the effect of local supply on the probability that a rider opening the Lyft app becomes an actual ride. Our model obtains this effect from experimental data by (1)", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2467, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "754c275b-fab4-48cd-b474-3ec6f9e46ffa": {"__data__": {"id_": "754c275b-fab4-48cd-b474-3ec6f9e46ffa", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "e0e94bd9-aefb-47aa-8195-61507e4b77b2", "node_type": "4", "metadata": {}, "hash": "9d34861c4eb5ce80836251ace57c2acdf448742f7d5edba5fca5732cb9672902", "class_name": "RelatedNodeInfo"}}, "text": "# 3.0 Rider request conversion gain (%)\n\n|No-PT bookings gain (%)|Gain (%)|Rider request conversion gain (%)|\n|---|---|---|\n|0.0|10|82|\n|0.5| |9|\n|1.0| | |\n|1.5| | |\n|2.0| | |\n|2.5| | |\n\nFigure 7: In the distribution (left) and joint (right) plots of the incremental gain in no-PT bookings and rider request conversions, the plots are normalized such that the area under the curves totals 1. The joint plot of the incremental gains (right subfigure) show that the gain in no-PT bookings (the objective) is about twice that of the rider conversion gain and that optimizing for either metric still improves the other.\n\nHeuristically estimating the counter-factual supply that would occur in a scenario with 100% treatment drivers or with 100% control drivers, and (2) using a machine learning model to map the counter-factual supply to incremental conversion (or, indeed, any market-level metric such as revenue, bookings, or ETAs). We then aggregate these micro-scale estimates to obtain the macro-level effect across the platform.\n\nSuppose we run a 50-50 driver-split test in which we assign half the drivers the old PT experience and half the drivers the new PPZ experience. For most drivers on our platform, the local supply will include both treatment and control drivers. We compute the counter-factual supply by rescaling the number of drivers in a group as if there were only drivers from that group. For example, if a rider had 5 nearby treatment drivers and 3 nearby control drivers, we compute 100% control supply as 3 \u00d7 2 = 6 and 100% treatment supply as 5 \u00d7 2 = 10. We make an additional adjustment that takes into account the way rides are matched and the riders\u2019 request elasticity with respect to supply.\n\nWe then combine our estimates of counter-factual supply with a conversion model. This is a machine learning model that was trained offline and estimates the probability that a rider requests a ride, given the observed local supply, observed local demand, plus other context features such as time and location. It is a flexible model that we can use to estimate the direct impact of the experiment by comparing the factual scenario to the 100% control counter-factual and the potential impact of rolling out the product by comparing the 100% treatment counter-factual to the 100% control counter-factual. In both cases, the incremental", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2354, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "375a97ee-7c38-4109-a767-04be4d3835a9": {"__data__": {"id_": "375a97ee-7c38-4109-a767-04be4d3835a9", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "29defb66-e9ea-4784-be99-3eeba7203251", "node_type": "4", "metadata": {}, "hash": "3f7e90c98f442de69726611fe0dc7598d36ccf0eff35c90b4062243f0d1c7ca5", "class_name": "RelatedNodeInfo"}}, "text": "# 2\n\n# 8\n\n# 1\n\n# L\n\n# 1\n\n# Figure 8:\n\nThe right skew in the distribution of gains can be explained because randomly sampling timestamps uniformly overwhelmingly returns timestamps with no-PT rides and therefore no escrow budget.\n\nConversion estimates are interpreted as causal, because they hold constant all the variables, other than local supply, that affect rider conversion.\n\nAs we note above, the goal of this approach is to remove most of the interference bias and produce estimates that are close to a bias-free, but in our case, infeasible experimental design. Some amount of bias is unavoidable, unfortunately. For example, when testing PPZ and the legacy system in a 50-50 driver-split test, the drivers in the legacy system observe prices that are set for all riders; that is, they depend partly on the positioning of the treatment drivers. To the extent that drivers chase the surge, which expert drivers recommend against as we mention above, this causes some interference bias in our results. Fortunately, our validation experiments showed that this residual bias is small compared to the interference bias for which our framework successfully corrects.\n\nWe validated our framework with a mixed time-split and driver-split design using a driver positioning incentive as treatment, which has similar marketplace effects to our PPZs but\n\n# 20", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1354, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "89fcf935-501f-4ea5-9876-24b856646907": {"__data__": {"id_": "89fcf935-501f-4ea5-9876-24b856646907", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "96498834-119d-4552-a4ce-fcb1e47fb499", "node_type": "4", "metadata": {}, "hash": "369cfbe7a347f35eb4b4581c31e4903d6fccf9ca35e216108efd3d4b157daaa4", "class_name": "RelatedNodeInfo"}}, "text": "# 8.2 Live Experiments: Results\n\n# Bookings\n\nWe implemented and tested the version of the PPZ model that optimizes for no-PT bookings in selected cities. Experimental results show that the performance improvement brought by the PPZ algorithm is consistent in all cities, with gains in the bookings averaging at slightly higher than 0.5.\n\n# Other marketplace improvements\n\nWe observed a reduction in ride pick-up times and, correspondingly, drivers spending more time in their cars with riders. We also observed improvements on a number of driver engagement metrics.\n\n- We saw a small but significant increase in active drivers for the drivers with PPZ versus the ones with the legacy system during the test period (+0.82%).\n- Drivers drove more hours with PPZ in both nonpeak and peak hours (+0.53%), with the biggest lift concentrated during peak hours (+1.43%).\n- ETAs (-1.1%) and driver cancel rates (-12.5%) were down significantly (thus validating PPZ\u2019s effectiveness on addressing the problem of drivers cherry-picking rides).\n\n# Driver earnings and driver sentiment\n\nDriver earnings were constant in aggregate. This is expected because we are only shifting the budget allocation and increased earnings would lead to increased supply, thus lowering driver utilization, and thereby decreasing earnings, again, in equilibrium [HHK21]. However, the distribution of earnings changed in a way that reduces the inequality induced by differences in experience levels (i.e., less experienced drivers are more productive with PPZ). In particular, median hourly driver earnings increased by $0.20 with PPZ, and by up to $0.50 during some weeks. Surveys sent to drivers who have experienced the product also show a preference for the PPZ product over PT across different cities. Some responses to the new system include the following quotes.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1836, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "cbbc2423-4946-4bd2-9e0a-fb39a05b268d": {"__data__": {"id_": "cbbc2423-4946-4bd2-9e0a-fb39a05b268d", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "97291e4a-0512-49d5-bdc6-ff4fb59f6ee4", "node_type": "4", "metadata": {}, "hash": "36c5aab85b7647309e9d9f8d5a67892475c6370b94ab98d69db89a496fd7e3ee", "class_name": "RelatedNodeInfo"}}, "text": "submitted by anonymous drivers in these surveys:\n\n\u201cBefore, I used to drive looking for my next pick up. Now I can stay in the area waiting for my next pick up and the good thing is I\u2019m waiting and earning money, thanks!\u201d\n\n\u201cLA is so big, nice to not waste time!\u201d\n\n\u201cIt\u2019s a great incentive and makes me want to go to areas to earn more on my rides.\u201d\n\nIn addition, we also received positive reviews from operations teams working in our major markets.\n\n\u201cPPZs increased utilization and hours. I think this was communicated well, intuitive for drivers. Performing well thus far\u2014all driver metrics look positive, and have not seen significant adverse sentiment in-market.\u201d\n\nGiven these promising results, the proposed algorithm and product have been successfully deployed on Lyft\u2019s ridesharing platform across all 320 cities. See Appendix C: Video of PPZs Served in Production for an illustration of the product being served \u201clive\u201d in the San Francisco Bay Area.\n\n# 9 Broader Impact\n\nThe introduction of mathematical optimization and, more generally, operations research techniques in this application has paved the way for more sophisticated analysis and decision making in incentive budgeting and generation. That Lyft already uses operations research techniques in many of its core applications, including order dispatch and trip pricing, is no surprise. That said, incentive budgeting and generation for drivers has previously been accomplished using heuristics. PPZ represents the first time that dynamic decision making in real time has been automated with mathematically principled algorithms.\n\nBeyond the PPZ product, the escrow mechanism we built is being developed to provide complementary real-time incentives that can access the same hundreds of millions of dollars of yearly budget. In particular, the escrow mechanism allows us to funnel part of the budget to other incentives that can act in tandem with PPZ to achieve even better market results. For example, as we can see from our live-test results, PPZ does not increase the participation rates of drivers in the short term; that is, it is not designed to encourage offline drivers to come online to drive on the platform, nor does it significantly impact them to do so. One direction that we are actively exploring is adapting weekly, manually managed incentives, which already exist for drivers (e.g., ride streaks), to encourage more drivers to come onto the platform when Lyft experiences an unexpected driver supply shortage.\n\nWe are currently working on some of these applications, stretching our system to account for different types of supply and testing new products that work in concert with PPZs. These new applications will help engage online drivers and signal earnings opportunities to offline drivers, with the broader goal of increasing market balance and efficiency on the platform.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2859, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "e591bd5f-5f8a-437f-8b73-8f73f733810d": {"__data__": {"id_": "e591bd5f-5f8a-437f-8b73-8f73f733810d", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "eea54be3-50a9-4b54-a365-925aadb4a7e5", "node_type": "4", "metadata": {}, "hash": "a4f0a635e1b1b17fbb10bc4ae7ba18e10794eb10d45221ce23e37288fc98a924", "class_name": "RelatedNodeInfo"}}, "text": "# Acknowledgments\n\nWe thank David Shmoys, Siddarth Patil, and Chris Sholley for their feedback on this paper and prior drafts. PPZ is still a work-in-progress, and the work would not have been possible without the support of many people and various teams at Lyft. The core group of researchers who helped develop the PPZ algorithm, the escrow mechanism, and its dependencies include Ido Bright, Cameron Bruggeman, Carolyn Cotterman, Benedict Kuester, Michael Rotkowitz, Lei Tang, and Michael Yoshizawa. The product has benefitted greatly from the feedback of our colleagues at Lyft and Lyft\u2019s users. In particular, we thank the following people for their contributions to PPZ: Ben Dear, Eduardo Apolinario, Matt Green, Dan Barragan, Praveen Athmanathan, Richard Zhao, Gaurav Gupta, Seth Melnick, Bryan Jung, David Linder, Efferman Ezell, Vijay Narasiman, Eli Schachar, Jia Yan, Ramon Iglesias, Varun Krishnan, Charlene Zhou, Akshay Balwally, San Tan, Udi Milo, Jose Abelenda, Jeremy Karp, Derek Salama, Adriel Frederick, John Fremlin, and Garrett J. van Ryzin.\n\n23", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1064, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "59acf0e8-a38f-4f63-a1b2-9f3376c6aaed": {"__data__": {"id_": "59acf0e8-a38f-4f63-a1b2-9f3376c6aaed", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "85fb42c9-7d17-4f14-bec1-af85400a4069", "node_type": "4", "metadata": {}, "hash": "fc1f746d0081fd18b00ef65e941e75e7373f3f3d8d0697af1978143c7236093f", "class_name": "RelatedNodeInfo"}}, "text": "# References\n\n- [ALM18] Philipp Af`eche, Zhe Liu, and Costis Maglaras. Ride-hailing networks with strategic drivers: The impact of platform control capabilities on performance. Rotman School of Management Working Paper, 2018.\n- [BCS16] Kostas Bimpikis, Ozan Candogan, and Daniela Saban. Spatial pricing in ride-sharing networks. Operations Research, 2016.\n- [BDLY19] Anton Braverman, JG Dai, Xin Liu, and Lei Ying. Empty-car routing in ridesharing systems. Operations Research, 67(5):1437\u20131452, 2019.\n- [BFL16] Siddhartha Banerjee, Daniel Freund, and Thodoris Lykouris. Pricing and optimization in shared vehicle systems: An approximation framework. arXiv preprint arXiv:1608.06819, 2016.\n- [BJR15] Siddhartha Banerjee, Ramesh Johari, and Carlos Riquelme. Pricing in ride-sharing platforms: A queueing-theoretic approach. In Proceedings of the Sixteenth ACM Conference on Economics and Computation, pages 639\u2013639. ACM, 2015.\n- [CBL18] Francisco Castro, Omar Besbes, and Ilan Lobel. Surge pricing and its spatial supply response. Columbia Business School Research Paper, 2018.\n- [CDL17] Gerard P Cachon, Kaitlin M Daniels, and Ruben Lobel. The role of surge pricing on a service platform with self-scheduling capacity. Manufacturing & Service Operations Management, 19(3):368\u2013384, 2017.\n- [Cha16] Nicholas Chamandy. Experimentation in a ridesharing marketplace: interference across a network, Sep 2016.\n- [CKW17] Juan Camilo Castillo, Dan Knoepfle, and Glen Weyl. Surge pricing solves the wild goose chase. In Proceedings of the 2017 ACM Conference on Economics and Computation, 2017.\n- [GN21] Nikhil Garg and Hamid Nazerzadeh. Driver surge pricing. https://gargnikhil.com/files/papers/garg_driversurge.pdf, 2021.\n- [Gri17] Gridwise. Why you should never chase surges (and what to do instead). https://gridwise.io/why-you-should-never-chase-surges-and-what-to-do-instead, aug 2017.\n- [HHK21] Jonathan V Hall, John J Horton, and Daniel T Knoepfle. Pricing in designed markets: The case of ride-sharing. 2021.\n- [LFK18] Alice Lu, Peter I Frazier, and Oren Kislev. Surge pricing moves uber\u2019s driver-partners. In Proceedings of the 2018 ACM Conference on Economics and Computation, 2018.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2182, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "95e77bcb-214b-4230-86f1-772fa9a2cc17": {"__data__": {"id_": "95e77bcb-214b-4230-86f1-772fa9a2cc17", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "db618e43-6a7f-4e87-82a8-37232cd32937", "node_type": "4", "metadata": {}, "hash": "0ba35ac21622deb20aa5f08605be002263efcb1ba1840c18bee7fb0f5da9512a", "class_name": "RelatedNodeInfo"}}, "text": "# References\n\n- [MFP19] Hongyao Ma, Fei Fang, and David C Parkes. Spatio-temporal pricing for ridesharing platforms. Proceedings of the 2018 ACM Conference on Economics and Computation, 2019.\n- [OW16] Erhun Ozkan and Amy R Ward. Dynamic matching for real-time ridesharing. 2016.\n- [Smi18] Mark Smithivas. Lyft\u2019s new prime time experiment review. https://therideshareguy.com/what-its-like-to-be-part-of-lyfts-new-prime-time-experiment/, 2018.\n- [TVR05] Kalyan T Talluri and Garrett J Van Ryzin. The theory and practice of revenue management, volume 68. Springer Science & Business Media, 2005.\n- [XLG+18] Zhe Xu, Zhixin Li, Qingwen Guan, Dingshui Zhang, Qiang Li, Junxiao Nan, Chunyang Liu, Wei Bian, and Jieping Ye. Large-scale order dispatch in on-demand ride-hailing platforms: A learning and planning approach. In Proceedings of the 24th ACM SIGKDD International Conference on Knowledge Discovery & Data Mining, pages 905\u2013913, 2018.\n- [YIF18] Pu Yang, Krishnamurthy Iyer, and Peter Frazier. Mean field equilibria for resource competition in spatial settings. Stochastic Systems, 8(4):307\u2013334, 2018.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1101, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "f164d191-adeb-4583-9c3f-4d60a10aae7d": {"__data__": {"id_": "f164d191-adeb-4583-9c3f-4d60a10aae7d", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "352aeac5-eaca-435e-9d74-354004736df1", "node_type": "4", "metadata": {}, "hash": "8eecd4e1791050bbc6ca43c2290d2e8d6c755cc1518848f57f09a91f22fe1f8e", "class_name": "RelatedNodeInfo"}}, "text": "# A Optimization Approach\n\nThe PPZ algorithm has two main subroutines: the driver positioning and incentive computation subproblems. We first define the notation and provide details of our model, which is independent of the methods for the allocation of PPZs or the evaluation of the platform efficiency. We then describe the optimization problems that we solve to generate PPZ allocations and the dollar bonus values offered for each PPZ. We refer the reader to the main text for a high-level overview of the system. We highlight that, to focus on the core challenges of the PPZ problem, we leave out an important component of the PPZ system. In particular, we assume that we have access to generic problem parameters that are used across many different teams at Lyft. This includes, among others, forecasts and estimates of supply, demand, and other important market conditions. Below, all defined quantities are given as forecasts or estimates of the market conditions unless otherwise stated.\n\n# A.1 The Model\n\n# A.1.1 Order dispatch.\n\nRidesharing platforms typically compute dispatches across a city or region, and Lyft is no exception. A balanced market has an adequate supply of drivers for the riders requesting ride dispatches (i.e., demand) at the geographic neighborhood level around any location. We call this the dispatch neighborhood. Consider a contiguous spatial region with n nonoverlapping, discrete spatial clusters or locations. We denote the \u201clocal\u201d demand and idle supply as (dreq)1:n and (s)1:n, respectively, for all locations i = 1, . . . , n. The \u201cneighborhood\u201d demand and idle supply around all locations i = 1, . . . , n are denoted as (dN req)1:n and (sN)1:n, respectively. To obtain the neighborhood quantities from the local ones, we introduce the dispatch neighborhood matrix M \u2208 {0, 1}n\u00d7n, where each entry Mij indicates whether locations i and j are within the same dispatch neighborhood. Using this matrix, we select and add up req the demand and supply within the neighborhood of each location (i.e., dN = M dreq and sN = M s). In practice, the neighborhood matrix depends on region-specific dispatch parameters and prevailing traffic conditions. It is also very sparse. We also, by ride prices and incentives, try to maintain a level of available drivers (r)1:n in the dispatch neighborhood of each location i = 1, . . . , n to avoid a wild goose chase scenario in future periods. As [CKW17] explain, a platform depleted of idle drivers is often required to match drivers with riders who are far from where the driver is positioned. These chases occupy drivers and reduce the rate of rides served and earnings, which exacerbate the problem. Through PT and PPZ, we simultaneously modulate demand and incentivize drivers to position themselves to maintain a healthy level of available drivers in the marketplace. We express the market-balancing condition as:\n\nreq = M dreq M s \u2212 r = sN \u2212 r.\n\ndN\n\n(1)\n\n26", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2938, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "efb8e075-2f66-4a57-972b-3733dd9d8486": {"__data__": {"id_": "efb8e075-2f66-4a57-972b-3733dd9d8486", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "4a3a1a13-78a1-4a26-964f-294ff14386fc", "node_type": "4", "metadata": {}, "hash": "755f15c2b1cb118af8652c3091b44d3420a10f5470890018b3da6c9a94333f6b", "class_name": "RelatedNodeInfo"}}, "text": "# A.1.2 Price modifiers and elasticity.\n\nThe PT service determines the price modifiers (x)1:n to be applied to rides at each location i = 1, . . . , n. We model the aggregate rider response to the price modification at each location n \u2192 [0, 1]n using a conversion function, which is given by y : R+. It gives the probability that a rider (unit demand) will request a ride at some location, given some PT value. Denoting the number of riders on the application determining whether to request a ride as d \u2208 R+n, the expected PT-modulated demand is dreq = d \u25e6 y (x), where \u25e6 denotes the Hadamard (elementwise) multiplication of vectors. Based on observed data, conversion exponentially decays with increasing prices.\n\n# A.1.3 Driver allocation.\n\nThe PPZ system determines the driver allocations A \u2208 Rn\u00d7n, where Aij is the fraction of drivers in location i to whom we serve incentives to encourage them to move to location j. Naturally, the driver allocation fractions originating from each location can sum at most to unity. We limit the repositioning incentives of drivers to within a geographic neighborhood of their original location to avoid placing the incentives too far away from the driver or at a location that cannot be reached (e.g., construction zones). We encode undesirable allocations by restricting the appropriate elements to zero in Amax \u2208 {0, 1}n\u00d7n. Our driver allocation constraint is\n\nA1 1, 0 \u2264 A \u2264 Amax. (2)\n\n# A.1.4 Supply dynamics.\n\nWe model the evolution of supply dynamics through the probability of a driver transitioning to a specific location k at the next period Pk,ij, given a PPZ to go from the driver\u2019s current location i to the location j. Drivers without PPZs stay open with probability P0. Suppose (s0)1:n is the pre-PPZ allocation driver count at locations i = 1, . . . , n. Then, the expected supply evolves as\n\ns = [1T (P1 ...\u25e6 A) s0] + P0 (I - diag (A1)) s0. (3)\n\nTo unpack this equation, recognize that Pk \u25e6 A gives the probability that each allocation will result in a transition to location k. Therefore, (Pk \u25e6 A) s0 gives the vector of drivers that, in expectation because of how we sample PPZ allocations for each driver, end up in location k from each origin location 1, . . . , n. Summing the elements of this vector produces the expected number of drivers that end up in location k. Next, recognize that A1 gives the total fraction of allocated drivers from each origin such that I - diag (A1) gives the unallocated fraction of drivers at each location. It now follows that (I - diag (A1)) s0 is the vector of driver counts that were unallocated at each location; multiplying it by P0 gives the n\u00d7n probability that they stay on the platform. Defining a response probability matrix Pc \u2208 R+.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2735, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "3bb177f3-861b-4159-92f0-160e250b3fc2": {"__data__": {"id_": "3bb177f3-861b-4159-92f0-160e250b3fc2", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "7bb116f6-1482-47cf-8c0b-5ff01e9de263", "node_type": "4", "metadata": {}, "hash": "56d382e2c45de695d2add60ad035339984f420aa95b7ce31a1d0f18ffd596ebe", "class_name": "RelatedNodeInfo"}}, "text": "# Current Page\n\n# A.1.5 Escrow budgeting\n\nThe escrow mechanism uses real-time PT and PPZ financial line items at ride accept to track the available budget to spend (e)1:n at each location i = 1, . . . , n. For any PPZ, the escrow mechanism requires a set of contributing accounts and contribution fractions that funds it. This set of contributions can be encoded by C \u2208 Rn\u00d7n, where Cij is the fraction of budget contribution from location i\u2019s escrow account to any PPZ with the destination location j. Similar to the allocation matrix constraint, we restrict invalid contributions to some location from a local account that is too far away from zero in Cmax \u2208 {0, 1}n\u00d7n. The contribution constraints\n\n0 \u2264 C \u2264 Cmax\n\nC1 1, (4)\n\nencode the fact that the (valid) budget contribution fractions must sum at most to unity. We require that the total amount of money allocated for each PPZ destination location cannot exceed the total available from the local balances Ce, even if we offered the minimum allowable bonus amount bmin to every responding driver (Pc \u25e6 A) s0. The contributions are thus governed by\n\nbmin (Pc \u25e6 A) s0 \u2264 Ce. (5)\n\nFor any valid allocation \u02dc, the final bonus values shown to drivers are governed by\n\n((         \u02dc)s0)b \u2264 Ce, bmin \u2264 b \u2264 bmax\n\ndiag(Pc \u25e6 A) (6)\n\nsuch that the total payout for all complied allocations in each destination location is not more than the budget available in the escrow account balances. Further, all bonus values are subject to lower and upper bounds bmin and bmax, respectively.\n\n# A.2 Driver Positioning\n\nThe driver positioning objective is to maximize the aspects of profit that PPZs can directly impact. Specifically, we maximize the expected no-PT bookings fT(d \u25e6 y (x)), where (f)1:n are the time-and-distance fares we expect to collect at locations i = 1, . . . , n. Our key decision variable is the allocation A and the free variables are the PT values x, the open supply that does not already have a PPZ s and thus can be offered an incentive to reposition, and the escrow contribution C. Note that \u00af is a parameter that gives the count of s drivers in each location that already have a PPZ and thus cannot receive an incentive to be repositioned. The positioning problem is to maximize the expected bookings subject to the market-balancing condition [Equation (1)], supply dynamics [Equation (3)], driver allocation constraints [Constraints (2)], and escrow budgeting constraints [Constraints (4) and\n\n28", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2457, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "5a71ba57-4505-4f5f-8598-a238e7c51ceb": {"__data__": {"id_": "5a71ba57-4505-4f5f-8598-a238e7c51ceb", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "32d5fd23-84ed-4d13-9938-cf101daf425a", "node_type": "4", "metadata": {}, "hash": "37f5c0757cf5d92a42a16bf5e4fa2f73dbd44e84de767f5d1187d698fbbe0e5f", "class_name": "RelatedNodeInfo"}}, "text": "# A.3 Incentive Computation\n\nFor each location i, the escrow mechanism provides a bonus target btgt that an open driver should ideally receive by averaging out the available account balances surrounding i. Recall that this is the chosen fair approach of splitting the marked-up income by averaging it out over all possible trips for which drivers can be dispatched from each destination. Given the optimal PPZ allocation A?, the incentive computation subproblem attempts to find escrow account contributions C to match the bonus values b with the ideal bonus target btgt such that \u2016b \u2212 btgt\u20162 is minimized. The bonus targets are set such that the available budget is fully spent. The solution is subject to the bonus value constraints [Constraints (6)] and the contribution simplex [Constraints (4)]. Note that simply setting the final bonus payout values to the ideal bonus target will not necessarily yield a feasible solution under the budget constraints. In particular, the minimum and maximum bonus values sometimes restrict us from using the ideal budget target as solutions. The problem is\n\nminimize \u2016b \u2212 btgt\u201622\n\nsubject to\n\n- diag ((Pc \u25e6 A?) s) b \u2264 CT e\n- bmin \u2264 b \u2264 bmax\n- C1 = 1, 0 \u2264 C \u2264 Cmax\n\nwhich yields the optimal bonus payouts b? and escrow contribution C?. In practice, we apply an `1 regularizer on the contributions C such that the set of accounts contributing to any PPZ is not excessively large.\n\n# A.4 Practical Implementation Details\n\nWe now describe some necessary steps that allow the optimization to run efficiently at Lyft\u2019s scale.\n\n29", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 1563, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "6c1e37f6-eec2-40e3-88ba-cb8bd0e2219e": {"__data__": {"id_": "6c1e37f6-eec2-40e3-88ba-cb8bd0e2219e", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "369fd348-471b-4887-ad19-f02ddfeb684e", "node_type": "4", "metadata": {}, "hash": "5058351fbaf00008888cedd8cafb88828cff1095981ca6d7f681f28dad8a46dc", "class_name": "RelatedNodeInfo"}}, "text": "# A.4.1 Convexification\n\nAs presented, the PPZ optimization problem is nonconvex, which greatly complicates its solution and, for all practical purposes, makes its computation potentially unfeasibly long. The nonconvexity is the result of the conversion function that appears in the adjusted market-balancing condition [Equation (1)] and the objective function.\n\nFortunately, a change-of-variable convexifies the problem. Since f is strictly monotone, we can let y = y (x) (in a slight abuse of notation) and recover x by inverting the conversion function. Observe that the new variable has domain y \u2208 [0, 1] and that each element yi is strictly decreasing in xi for i = 1, . . . , n. With this change-of-variable, Equation (1) and the objective function become affine. Our trick here resembles the standard revenue management technique to optimize over quantiles rather than prices [TVR05].\n\n# A.4.2 Allocation vectorization\n\nEven in a city of modest size, there are easily more than 10,000 locations to consider, which yields more than 100,000,000 allocation variables. The authors are not aware of solvers that can solve such large problem instances in a matter of seconds, which is a requirement for our real-time application. Luckily, because allocation neighborhoods are generally far smaller than the size of the entire region and there are operationally undesirable allocation pairs, Amax and therefore any valid allocation is extremely sparse. We vectorize the allocation matrix by constructing an allocation vector where each element corresponds to a valid allocation pair as indicated by a nonzero entry in Amax.\n\n# A.4.3 Location pruning\n\nWe consider only locations that are affected by demand and supply changes to ensure solution efficiency. Specifically, we only consider the union of two types of locations. The first type comprises locations with nonzero demand, and the locations within their dispatch neighborhood. The second type comprises locations with nonzero PPZ-assignable supply that have an allocation neighborhood that has any overlap with the dispatch neighborhood of locations with nonzero demand, and the locations within their allocation neighborhood. These form our active set of locations that we consider in the mathematical program. Combining location pruning with allocation vectorization, we are able to drastically reduce the number of decision variables, while provably preserving the optimal solution. This reduces the number of variables to under 100,000, even for our largest markets. Using the FICO Xpress quadratic program commercial solver on an AWS C5n instance featuring four 3.0 GHz Intel Xeon Platinum processors and 21 GiB of memory, we are able to consistently solve the problems in seconds and deliver fresh PPZ incentives every minute.", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2789, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "4a4a1b59-f3eb-4fba-875c-042adb9d25d2": {"__data__": {"id_": "4a4a1b59-f3eb-4fba-875c-042adb9d25d2", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "0803b89a-0adf-4dab-9b17-68b99acfcf02", "node_type": "4", "metadata": {}, "hash": "8c539d4b071a43857cdba2034e6857e393f016a785071d1f70269fe71917de9a", "class_name": "RelatedNodeInfo"}}, "text": "# Perturbation and Sensitivity Analysis\n\nIn this appendix we provide analytical sensitivity results to demonstrate that the local sensitivity approach fails to accurately represent market conditions.\n\nConsider Problem (7), the driver positioning problem, except that drivers are fixed in their original locations and the only variable is the conversion quantile y. Our problem is to maximize the expected sum of trip fares by setting appropriate multiplicative price modifiers n, which affect the conversion of rider app-opens into requests y. Solving this problem x \u2208 R+ thus gives us the maximum revenue or bookings we can achieve from the market given the supply distribution that we currently have. This simplified market-optimizing problem is\n\nminimize       fobj (x) = \u2212f T (d \u25e6 y)                                       (9)\n\nsubject to M (d \u25e6 y)  M s0 \u2212 r.\n\nSuppose Problem (9) is feasible. Because we have a linear program, strong duality holds. Here, the optimal dual variables provide insights on the sensitivity of the optimal value with respect to the perturbations of the constraints. In particular, they tell us how the optimal market revenue varies with respect to changes in the market-balancing conditions and, in turn, how demand, pricing, and supply may influence the revenue.\n\n# The Perturbed Problem\n\nWe consider the following perturbed version of the original Problem (9):\n\nminimize       fobj (y) = \u2212f T (d \u25e6 y)                                        (10)\n\nsubject to M (d \u25e6 y) \u2212 (M s0 \u2212 r)  q\n\nwith variables y. The problem coincides with the original optimization problem when q = 0. When q > 0, we have relaxed the constraint; when q < 0, we have tightened it. Thus, the perturbed problem results from the original problem by tightening or relaxing the right side of the adjusted market-balancing inequality by q.\n\nFor the sake of clear exposition in this section, we will rewrite the optimization Problem (10) as\n\nminimize       fobj (y)                                              (11)\n\nsubject to f mkt (y)  q,\n\nwhere f mkt is the left side of the perturbed problem\u2019s adjusted market-balancing condition.\n\nWe define p? (q) as the optimal value of the perturbed Problem (11)\n\np? (q) = inf {f obj (y) \u2223 y \u2208 D, f mkt (y)  q} ,\u2223                                 (12)\n\nwhere D is the domain of the optimization problem (i.e., the set of the points that are defined on the objective and constraint functions). We can have p? (q) = \u221e correspond to the perturbations of the constraints that results in infeasibility. Note that p? (0) = p optimal value of the unperturbed problem. Roughly speaking, the function p? : Rn?, the\u2192 R", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2647, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "e58c80c8-9e03-46f0-bf16-5529246b8ed0": {"__data__": {"id_": "e58c80c8-9e03-46f0-bf16-5529246b8ed0", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "d2dd0f2c-3d39-414c-a7e0-a4cf7b3d0776", "node_type": "4", "metadata": {}, "hash": "29dfbb4b10b1098486716af3301433abaa4e4497a9cd433703505680adc1dc0e", "class_name": "RelatedNodeInfo"}}, "text": "# B.2 Local Sensitivity Analysis\n\nLet (\u03bb?, \u03bd?) be optimal for the dual of the unperturbed optimization Problem (9), where \u03bb is the dual variable that corresponds to the market-balancing constraint and \u03bd is the dual variable that corresponds to the price modifier constraint. Suppose now that p? (q) is differentiable at q = 0. Then, provided that strong duality holds, the optimal dual variable \u03bb? equals the gradient of p? at q = 0 with respect to q, that is,\n\n\u03bbi ?= \u2212\u2202p\u2202qi? (0). (13)\n\nThis means that if the above conditions hold, the optimal Lagrange multipliers are exactly the local sensitivities of the optimal value with respect to constraint perturbations. In economics, \u03bb and \u03bd are often referred to as the natural or equilibrium prices or \u201cshadow prices\u201d of their corresponding constraints. In the case of the market-balancing conditions, these can be thought of as the price that we should accord to (marginal) supply in the dispatch neighborhoods. That is, \u03bbi ? is the marginal value of supply in PPZ\u2019s context.\n\nLocally, this interpretation is symmetric: decreasing the supply count in the ith location\u2019s dispatch neighborhood by a small amount (i.e., taking qi small and negative) yields a change in the optimal market revenue objective value \u2212p? of approximately \u2212\u03bbi ?q; increasing the supply count in the ith location\u2019s dispatch neighborhood by a small amount (i.e., taking qi small and positive) yields an increase of approximately \u03bbi ?q. Thus, Equation (13) gives us precisely the marginal value of supply to use in a local sensitivity approach.\n\nThis local sensitivity result gives us a quantitative measure of how active a market-balancing constraint is at the optimum y?. If f imkt < 0, then the constraint is inactive, and it follows that the supply count can be decreased or increased a little without affecting the optimal market revenue objective value. By complementary slackness, the associated Lagrange multiplier \u03bbi? must be zero. However, now suppose that f imkt = 0, that is, the market-balancing constraint for the ith location\u2019s dispatch neighborhood is active at the optimum. The ith optimal Lagrange multiplier tells us how active the constraint is: if \u03bbi? is small, it means that the supply count can be decreased or increased a little without much effect on the optimal market revenue objective value; if \u03bbi? is large, it means that if the supply count is decreased or increased a little a bit, the effect on the optimal market revenue objective value will be great.\n\n32", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2507, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "35583672-d782-4acb-96c0-8e2ba52e4649": {"__data__": {"id_": "35583672-d782-4acb-96c0-8e2ba52e4649", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "6224201b-4efd-42a0-9cef-0946e4fe84e2", "node_type": "4", "metadata": {}, "hash": "c4009c09aa3b9f6a9d0db40cd0da90a91f3a69b0401cca67af8915d4dfb85dc9", "class_name": "RelatedNodeInfo"}}, "text": "# B.3 Global Sensitivity Analysis\n\nThis analysis motivates a natural approach to allocate PPZs based on \u03bb?: PPZs should incentivize drivers to reposition from locations i with small \u03bbi? to locations j with large \u03bbj ?. Based on the above, one would expect this to increase the market revenue. Unfortunately, as we will demonstrate, the local sensitivity analysis does not generalize beyond the point at which the marginal value of supply was evaluated.\n\nTo examine how the local sensitivity results break down, consider Equation (12). For all q, we will show that\n\np? (q) \u2265 p? (0) \u2212 \u03bb?T q. (14)\n\nTo establish this inequality, suppose y is feasible for the perturbed problem. Then we have, by strong duality,\n\np? (0) = g (\u03bb?, \u03bd?) \u2264 f obj (y) + \u03bb?T f mkt (y) + \u03bd?T f bal (y) \u2264 f obj (y) + \u03bb?T q + \u03bd?T 0 = f obj (y) + \u03bb?T q.\n\nHere, g is the Lagrange dual function and the first inequality follows from its definition. Recall also that \u03bb? 0 by definition of the Lagrange dual problem. We thus have\n\nf obj (y) \u2265 p? (0) \u2212 \u03bb?T q,\n\nwhich leads to Inequality (14). Recall that p? (q) is the negative of the perturbed optimal market revenue objective value.\n\nFor clarity, we can rewrite the inequality constraint as\n\n\u2212p? (q) \u2264 \u03bb?T q \u2212 p? (0)\n\nand make the two following observations:\n\n1. Suppose \u03bbi? is large and we decrease the supply count in the ith location\u2019s dispatch neighborhood; that is, we tighten the ith constraint and choose qi < 0. Then the optimal market revenue objective value of the objective \u2212p? (q) will decrease greatly.\n2. Suppose \u03bbi? is small and we increase the supply count in the ith location\u2019s dispatch neighborhood; that is, we loosen the ith constraint and choose qi > 0. Then the optimal market revenue objective value of the objective \u2212p? (q) will not increase too much.\n\nSo far, these observations align with the results obtained from the local sensitivity analysis. The inequality established and the two observations above provide an upper bound on \u2212p? (q), the optimal market revenue objective value of the perturbed version of the original.\n\n33", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 2068, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "8c2f7bdb-0383-4a2d-9b05-cac3b05f6061": {"__data__": {"id_": "8c2f7bdb-0383-4a2d-9b05-cac3b05f6061", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "44b5c628-e4cf-4b05-a77a-3b6353959098", "node_type": "4", "metadata": {}, "hash": "4c5cb864d6f613f120deec2700bd6ccc6c7341aefd42caf31d6e4c5161b8a880", "class_name": "RelatedNodeInfo"}}, "text": "# Market-Optimizing Problem\n\nNotice, however, that it establishes no lower bound of the perturbed optimal market revenue objective. We thus see that the results are not symmetric with respect to increasing or decreasing the supply count in the market-balancing constraint.\n\nTo illustrate this more clearly, consider the case where \u03bbi is large and we slightly increase the supply count in the ith location\u2019s dispatch neighborhood; that is, loosen the ith constraint slightly and choose qi > 0 for some small q. In this case, our inequality is not helpful in establishing any conclusion about how the perturbed optimal market revenue objective changes; it certainly does not imply that the perturbed optimal market revenue objective \u2212p? (q) increases considerably. In other words, a large optimal dual variable value for some location\u2019s dispatch neighborhood does not imply that adding more drivers to it will improve the market conditions.\n\nRecall the rule of incentivizing drivers to move from locations i with small \u03bbi to locations j with large \u03bbj established from our local sensitivity results. Unlike what our local sensitivity results suggest, our global sensitivity result tells us that a large \u201cshadow price\u201d or \u201cmarginal value of supply\u201d for some location does not imply that incentivizing drivers to reposition to that location will yield market revenue gains. Given that incentivizing drivers to reposition away from a location i may, even with small \u03bbi, yield large market revenue drops, simply using a static value of supply defined by an optimal Lagrange multiplier can hurt us because of this asymmetry. Recalling Figure 3, this asymmetry is apparent in both the analytical and the empirical estimates. Thus, a static set of shadow prices is a poor way to coordinate how supply is managed. If at all useful, it might be for visualizing snapshots of and providing spatial intuition for how severe the supply shortage is across a city. To actually coordinate supply management tools, we needed a fundamentally different approach, as we have discussed in this paper.\n\n# C. Video of PPZs Served in Production\n\nAn videographic illustration of actual PPZ incentives being served in production for the San Francisco Bay Area can be found at https://youtu.be/mlxY-qxlb6w. The data for this video were obtained from the period of April 20\u201321, 2019. The video plays back the PPZs created for and earned by actual drivers and provides some intuition about when and where repositioning opportunities are. Figure 9 is a snapshot of the video, with the colored arcs representing the origin and destination of the PPZ directions. The PPZ origin is represented by the end of the arc in a lighter hue and the destination the one in a darker hue. The purple arcs indicate PPZs that were eventually satisfied and earned by drivers, whereas the teal arcs indicate PPZs that were not satisfied. The highlighted boxes indicate the location buckets used in our algorithm, with red indicating areas of higher actual PT and yellow areas of lower PT. When there is no PT, there is no highlight. The rate of PPZs generated is indicated in a time-series plot at the bottom of the video, providing a sense of the seasonality of when the best opportunities to allocate PPZs are (typically, morning and evening commutes to and from the residential and downtown areas of the city).\n\n34", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 3366, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}, "5f26c658-e98b-4588-bd44-31daf93b2af0": {"__data__": {"id_": "5f26c658-e98b-4588-bd44-31daf93b2af0", "embedding": null, "metadata": {}, "excluded_embed_metadata_keys": [], "excluded_llm_metadata_keys": [], "relationships": {"1": {"node_id": "b1619346-c4a4-4190-bacb-f7a0411ad965", "node_type": "4", "metadata": {}, "hash": "febaf131872b92b5408d0a0f7d63821b65e48e564e3f1e0b37302973cc5a432f", "class_name": "RelatedNodeInfo"}}, "text": "# San Francisco\n\n# Poliao\n\n# Jnnct suns\n\n# ct Hill\n\n# Sunsct\n\n# Distrct\n\n# Itatl\n\nFigure 9: This snapshot of the video illustrates PPZs actually served in the San Francisco Bay Area. Note that the arc colors are used to indicate whether the drivers complied with and earned the incentives.\n\n35", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 293, "text_template": "{metadata_str}\n\n{content}", "metadata_template": "{key}: {value}", "metadata_seperator": "\n", "class_name": "TextNode"}, "__type__": "1"}}, "docstore/ref_doc_info": {"27bfdc15-3f59-4992-8659-4b532ba28f77": {"node_ids": ["99fd3556-5fc5-43f3-85bf-302baa3df818"], "metadata": {}}, "3888170d-5508-4326-85f4-e9f7a8471b80": {"node_ids": ["f652ff15-f4f9-4144-b18f-b43dd2473816"], "metadata": {}}, "d40fbb26-d7a8-4d3e-a2d0-3e472a150254": {"node_ids": ["0ba16b7d-948e-4ba2-8b17-1f072eb1ab99"], "metadata": {}}, "1117bc87-6ef8-452e-9754-9671a2ebb9ed": {"node_ids": ["eb4dbd72-5035-42a4-8a77-a7216c260855"], "metadata": {}}, "cb0da17b-71fb-4820-8b80-188bccf29b5e": {"node_ids": ["6a4ca8c1-d51a-4f6c-9cde-1361f7654247"], "metadata": {}}, "0435041d-c9ef-4eb1-9b39-a907d02384fc": {"node_ids": ["2839863e-030f-4b4d-a6cd-14603febb442"], "metadata": {}}, "e21f8e32-57bd-4673-bbf1-868381c1b8fe": {"node_ids": ["306bf6c5-26af-4d71-8cd3-9c955251f4dd"], "metadata": {}}, "20899be0-7bb6-432e-aca4-523e402f5c06": {"node_ids": ["b032bedb-664e-47ae-b868-8865031413c9"], "metadata": {}}, "d257f9ff-57fa-4031-b2f2-0656b3345edd": {"node_ids": ["cd4d54ee-fe13-445f-ab46-ad8c9e14e33d"], "metadata": {}}, "93c933e3-1f25-45ef-9d39-ad622f69e126": {"node_ids": ["d29cee82-e7a2-460d-886e-5e0bf4cd6f2f"], "metadata": {}}, "0d3592d4-6aa8-4700-8c69-77087c11060c": {"node_ids": ["2b8ff910-07ea-4243-bfc8-b5b86b4aac20"], "metadata": {}}, "6882b8ec-6e55-45c7-b489-7ac2ba1f3488": {"node_ids": ["b86d9017-074e-4a8c-af4b-04901d17dc3a"], "metadata": {}}, "bae8eb49-a2c5-46f1-b4ca-52407bc5c4a1": {"node_ids": ["c03b3fd3-9898-4f6f-8f83-9f9f38e72f44"], "metadata": {}}, "707987a8-0c39-47b7-94d1-9663fa24b198": {"node_ids": ["f26bf9e3-307f-4dce-a900-0c1a2a7299ac"], "metadata": {}}, "3ef385b5-8499-4b8f-bf7c-44100a4762a6": {"node_ids": ["f5885ab4-fcd5-427d-8db1-ac96e2ee5a6c"], "metadata": {}}, "b75f3b15-933c-4b74-8b49-c7f9042e2149": {"node_ids": ["9c22cf27-a2e1-4b70-8d48-e07e45948111"], "metadata": {}}, "a81c6658-672d-41b7-8961-12fd3ce171d0": {"node_ids": ["aba5af4a-4bc7-47d7-a50a-5a3038f32571"], "metadata": {}}, "e8cf0a5a-bf22-4d0f-92f3-f3de3bdb9fc1": {"node_ids": ["1ad1dad3-510e-4df4-a338-ba9e9b91e5f8"], "metadata": {}}, "e0e94bd9-aefb-47aa-8195-61507e4b77b2": {"node_ids": ["754c275b-fab4-48cd-b474-3ec6f9e46ffa"], "metadata": {}}, "29defb66-e9ea-4784-be99-3eeba7203251": {"node_ids": ["375a97ee-7c38-4109-a767-04be4d3835a9"], "metadata": {}}, "96498834-119d-4552-a4ce-fcb1e47fb499": {"node_ids": ["89fcf935-501f-4ea5-9876-24b856646907"], "metadata": {}}, "97291e4a-0512-49d5-bdc6-ff4fb59f6ee4": {"node_ids": ["cbbc2423-4946-4bd2-9e0a-fb39a05b268d"], "metadata": {}}, "eea54be3-50a9-4b54-a365-925aadb4a7e5": {"node_ids": ["e591bd5f-5f8a-437f-8b73-8f73f733810d"], "metadata": {}}, "85fb42c9-7d17-4f14-bec1-af85400a4069": {"node_ids": ["59acf0e8-a38f-4f63-a1b2-9f3376c6aaed"], "metadata": {}}, "db618e43-6a7f-4e87-82a8-37232cd32937": {"node_ids": ["95e77bcb-214b-4230-86f1-772fa9a2cc17"], "metadata": {}}, "352aeac5-eaca-435e-9d74-354004736df1": {"node_ids": ["f164d191-adeb-4583-9c3f-4d60a10aae7d"], "metadata": {}}, "4a3a1a13-78a1-4a26-964f-294ff14386fc": {"node_ids": ["efb8e075-2f66-4a57-972b-3733dd9d8486"], "metadata": {}}, "7bb116f6-1482-47cf-8c0b-5ff01e9de263": {"node_ids": ["3bb177f3-861b-4159-92f0-160e250b3fc2"], "metadata": {}}, "32d5fd23-84ed-4d13-9938-cf101daf425a": {"node_ids": ["5a71ba57-4505-4f5f-8598-a238e7c51ceb"], "metadata": {}}, "369fd348-471b-4887-ad19-f02ddfeb684e": {"node_ids": ["6c1e37f6-eec2-40e3-88ba-cb8bd0e2219e"], "metadata": {}}, "0803b89a-0adf-4dab-9b17-68b99acfcf02": {"node_ids": ["4a4a1b59-f3eb-4fba-875c-042adb9d25d2"], "metadata": {}}, "d2dd0f2c-3d39-414c-a7e0-a4cf7b3d0776": {"node_ids": ["e58c80c8-9e03-46f0-bf16-5529246b8ed0"], "metadata": {}}, "6224201b-4efd-42a0-9cef-0946e4fe84e2": {"node_ids": ["35583672-d782-4acb-96c0-8e2ba52e4649"], "metadata": {}}, "44b5c628-e4cf-4b05-a77a-3b6353959098": {"node_ids": ["8c2f7bdb-0383-4a2d-9b05-cac3b05f6061"], "metadata": {}}, "b1619346-c4a4-4190-bacb-f7a0411ad965": {"node_ids": ["5f26c658-e98b-4588-bd44-31daf93b2af0"], "metadata": {}}}}